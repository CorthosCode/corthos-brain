
OIDC (OpenID Connect) ‚Äî —ç—Ç–æ **—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ OAuth 2.0**, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–±–∞–≤–ª—è–µ—Ç **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (authentication)** –ø–æ–≤–µ—Ä—Ö **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (authorization)**.

–ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ:

üîπ **OAuth 2.0** –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: ‚Äú–ú–æ–∂–Ω–æ –ª–∏ —ç—Ç–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?‚Äù

üîπ **OIDC** –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: ‚Äú–ö—Ç–æ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?‚Äù


***

## üß© –ß—Ç–æ –¥–µ–ª–∞–µ—Ç OIDC

OIDC –¥–æ–±–∞–≤–ª—è–µ—Ç **–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π** –∫ OAuth 2.0.

–¢–æ –µ—Å—Ç—å –∫—Ä–æ–º–µ *access token* (—Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞), –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –µ—â—ë –∏ **ID Token** ‚Äî —ç—Ç–æ **JWT**, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:

```json
{
  "iss": "https://accounts.google.com",  // –∫—Ç–æ –≤—ã–¥–∞–ª —Ç–æ–∫–µ–Ω (Identity Provider)
  "sub": "1234567890",                   // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "name": "Nikita Kotov",
  "email": "nikita@example.com",
  "picture": "https://avatars.githubusercontent.com/u/12345"
}
```


***

## üîê –ü–æ—Ç–æ–∫–∏ (flows)

OIDC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –ø–æ—Ç–æ–∫–∏, —á—Ç–æ –∏ OAuth 2.0, –Ω–æ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º ID Token.

–ù–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π:

**Authorization Code Flow**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ‚Äú–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google / GitHub / Keycloak‚Äù.
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Keycloak, Google –∏ —Ç.–¥.).
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å.
4. –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å **authorization code**.
5. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ —ç—Ç–æ–º—É –∫–æ–¥—É –ø–æ–ª—É—á–∞–µ—Ç:
   * `access_token` ‚Äî –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API;
   * `id_token` ‚Äî —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.


***

## üí° –ü—Ä–∏–º–µ—Ä: –æ—Ç–ª–∏—á–∏–µ OAuth –∏ OIDC

|                     | OAuth 2.0                       | OIDC (–Ω–∞ –±–∞–∑–µ OAuth 2.0)                  |
| ------------------- | ------------------------------- | ----------------------------------------- |
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ          | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º) | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏)     |
| –¢–æ–∫–µ–Ω               | Access Token                    | Access Token + ID Token                   |
| –§–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞       | –õ—é–±–æ–π (—á–∞—Å—Ç–æ opaque)            | JWT                                       |
| –ò–Ω—Ñ–æ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ | –ù–µ—Ç                             | –ï—Å—Ç—å (–≤ ID Token –∏ –≤ `userinfo` endpoint) |


–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–∏–ª—Å—è –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏–ª –∫–ª–∏–µ–Ω—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ —Å `code`, –∫–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç **POST-–∑–∞–ø—Ä–æ—Å** –Ω–∞ *token endpoint* (–Ω–∞–ø—Ä–∏–º–µ—Ä):

```shellscript
POST https://idp.example.com/realms/myrealm/protocol/openid-connect/token
```

—Å —Ç–µ–ª–æ–º:

```shellscript
grant_type=authorization_code
code=abc123xyz
redirect_uri=http://localhost:8080/login/oauth2/code/keycloak
client_id=my-client
client_secret=my-secret
```

–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø—Ä–∏–º–µ—Ä JSON):

```json
{
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 300,
  "refresh_expires_in": 1800,
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "not-before-policy": 0,
  "session_state": "d8f4a5b3-0eac-4e2b-b8e9-9c1e0371e0e5",
  "scope": "openid email profile"
}
```

–†–∞—Å—à–∏—Ñ—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ ID Token (`id_token` ‚Äî —ç—Ç–æ **JWT**, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å):

```json
{
  "iss": "http://localhost:8080/realms/myrealm",    // –∫—Ç–æ –≤—ã–¥–∞–ª —Ç–æ–∫–µ–Ω
  "sub": "1f3a4b6e-1c0f-45d3-b46e-12aab3a4d2ef",    // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "aud": "my-client",                               // –∫–æ–º—É –≤—ã–¥–∞–Ω —Ç–æ–∫–µ–Ω (client_id)
  "exp": 1731023840,                                // —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
  "iat": 1731023540,                                // –≤—Ä–µ–º—è –≤—ã–¥–∞—á–∏
  "auth_time": 1731023529,                          // –≤—Ä–µ–º—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  "preferred_username": "nikita",
  "email": "nikita@example.com",
  "name": "Nikita Kotov",
  "given_name": "Nikita",
  "family_name": "Kotov",
  "picture": "https://avatars.githubusercontent.com/u/1234567"
}
```


***

## üß≠ –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

* **Keycloak** ‚Äî Identity Provider, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π OIDC.
* **Google / GitHub / Okta / Auth0** ‚Äî —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç OIDC.
* –í Spring Security OIDC –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –º–æ–¥—É–ª—å `spring-boot-starter-oauth2-client`.

