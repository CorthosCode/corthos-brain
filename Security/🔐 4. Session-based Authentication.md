
**Session Auth** ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è (–∏ –¥–æ —Å–∏—Ö –ø–æ—Ä —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —Å —Ñ–æ—Ä–º–∞–º–∏ –≤—Ö–æ–¥–∞.

–û–Ω –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç–æ–º, —á—Ç–æ **—Å–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç stateless-–ø–æ–¥—Ö–æ–¥–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏).


***

## ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —à–∞–≥ –∑–∞ —à–∞–≥–æ–º

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è**
   ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏ `username` –∏ `password` –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ POST `/login`).
2. **–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ**
   ‚Üí –ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Äî —Å–æ–∑–¥–∞—ë—Ç **—Å–µ—Å—Å–∏—é** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `sessionId = 12345abc`)
   ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –≤ –ø–∞–º—è—Ç–∏, –ë–î –∏–ª–∏ Redis, –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫—Ç–æ –æ–Ω, —Ä–æ–ª–∏ –∏ —Ç. –¥.).
3. **–°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie**
   ‚Üí –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç cookie:

```java
Set-Cookie: JSESSIONID=12345abc; HttpOnly; Secure
```

1. **–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie –æ–±—Ä–∞—Ç–Ω–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ**

```java
Cookie: JSESSIONID=12345abc
```

1. **–°–µ—Ä–≤–µ—Ä –∏—â–µ—Ç —Å–µ—Å—Å–∏—é –ø–æ ID**
   ‚Üí –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å—á–∏—Ç–∞–µ—Ç –µ–≥–æ ‚Äú–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º‚Äù.
   ‚Üí –ï—Å–ª–∏ —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç (–∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∞) ‚Üí `401 Unauthorized`.


***

## üíª –ü—Ä–∏–º–µ—Ä –≤ Spring Boot

Spring Security —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **session auth** "–∏–∑ –∫–æ—Ä–æ–±–∫–∏" ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/login", "/register").permitAll()
                .anyRequest().authenticated()
            )
            .formLogin()  // <‚Äî —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ (—Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é)
            .and()
            .logout()
            .and()
            .csrf().disable(); // –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞
        return http.build();
    }
}

```

–ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—Å—Ç `JSESSIONID`, –∏ –±—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å cookie —Å –Ω–∏–º.


***

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏

```java
http
  .sessionManagement(session -> session
      .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
      .maximumSessions(1)  // –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
      .maxSessionsPreventsLogin(true)
  );
```

**–ü–æ–ª–∏—Ç–∏–∫–∏:**
* `ALWAYS` ‚Äî –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é;
* `IF_REQUIRED` ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é);
* `NEVER` ‚Äî –Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏–∏;
* `STATELESS` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ JWT (–±–µ–∑ —Å–µ—Å—Å–∏–π –≤–æ–æ–±—â–µ).


***

## –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

–ß—Ç–æ–±—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤), –∏—Å–ø–æ–ª—å–∑—É—é—Ç **Spring Session**:

```http
<dependency>
  <groupId>org.springframework.session</groupId>
  <artifactId>spring-session-data-redis</artifactId>
</dependency>
```

–¢–æ–≥–¥–∞ –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã —á–∏—Ç–∞—é—Ç/–ø–∏—à—É—Ç —Å–µ—Å—Å–∏–∏ –∏–∑ Redis, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ç–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏.


***

## üß† –ò—Ç–æ–≥–æ

Session Auth:
* ‚úÖ –£–¥–æ–±–µ–Ω –¥–ª—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ª–æ–≥–∏–Ω–æ–º/—Ñ–æ—Ä–º–∞–º–∏;
* ‚úÖ Cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º;
* ‚ö†Ô∏è –ù–µ—É–¥–æ–±–µ–Ω –¥–ª—è API –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (–∏–∑-–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è);
* ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (HTTPS).

