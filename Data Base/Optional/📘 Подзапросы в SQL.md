
–ü–æ–¥–∑–∞–ø—Ä–æ—Å (subquery) ‚Äî —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä `SELECT`, –≤–ª–æ–∂–µ–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä—å –¥—Ä—É–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (`SELECT`, `INSERT`, `UPDATE`, `DELETE`).

–ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã –±—ã–≤–∞—é—Ç **–∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏–µ** –∏ **–Ω–µ–∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏–µ**.


[[üìò –ü—Ä–µ–¥–∏–∫–∞—Ç—ã –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ SQL]]


***

## –ù–µ–∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å (non-correlated)

* –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑**.
* –ï–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–µ–º –∑–∞–ø—Ä–æ—Å–µ.
* –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä–æ–∫ –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
* –û–±—ã—á–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ `IN`, `ANY`, `ALL`, `EXISTS`, –∏–ª–∏ –∫–∞–∫ —Å–∫–∞–ª—è—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.


### –ü—Ä–∏–º–µ—Ä 1: `IN`

```sql
SELECT name, salary
FROM employees
WHERE department_id IN (
    SELECT id
    FROM departments
    WHERE location = 'New York'
);
```

* –ü–æ–¥–∑–∞–ø—Ä–æ—Å –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Å–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã –∏–∑ –ù—å—é-–ô–æ—Ä–∫–∞.
* –í–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ —ç—Ç–∏–º –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º.
* –ü–æ–¥–∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑.


### –ü—Ä–∏–º–µ—Ä 2: —Å–∫–∞–ª—è—Ä–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å

```sql
SELECT name, salary
FROM employees
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
);
```

* –°–Ω–∞—á–∞–ª–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ.
* –ü–æ—Ç–æ–º –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, —É –∫–æ–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ.


***

## –ö–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å (correlated)

* –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–º–Ω–æ–≥–æ —Ä–∞–∑** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
* –°—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
* –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å `EXISTS`, `IN`, `=`, `<`, `>`.


### –ü—Ä–∏–º–µ—Ä 1: `EXISTS`

```sql
SELECT e.name, e.salary
FROM employees e
WHERE EXISTS (
    SELECT 1
    FROM bonuses b
    WHERE b.employee_id = e.id
);
```

* –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ `employees` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–¥–∑–∞–ø—Ä–æ—Å.
* –ï—Å–ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ `bonuses`, —Å—Ç—Ä–æ–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.


### –ü—Ä–∏–º–µ—Ä 2: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞

```sql
SELECT e.name, e.salary
FROM employees e
WHERE e.salary > (
    SELECT AVG(salary)
    FROM employees
    WHERE department_id = e.department_id
);
```

* –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ **–≤ –µ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–µ**.
* –ï—Å–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É ‚Äî –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

