
![](assets/tN3rGRRnx53yiG3dZ8aqzJ8GQ0I6zUpcZlwXV1jF_Ec=.png)


Хотя мы пишем запрос в логическом порядке:

```sql
SELECT ...
FROM ...
WHERE ...
GROUP BY ...
HAVING ...
ORDER BY ...
LIMIT ...
```

— на самом деле сервер БД обрабатывает его **в другом порядке**.


***

## Источник данных (Source)

* Этап: выбираются таблицы и представления, указанные в `FROM`.
* Если есть `JOIN` — происходит объединение таблиц.
* Пример:

```sql
FROM employees e
JOIN departments d ON e.dept_id = d.id
```


***

## Объединение (Merged)

* После `FROM` таблицы соединяются (JOIN, CROSS JOIN, NATURAL JOIN).
* Результат: единая временная таблица.


***

## Фильтрация строк (Filtered — WHERE)

* Применяются условия `WHERE`, которые отбирают строки.
* ⚠️ На этом этапе нельзя использовать агрегатные функции (`SUM`, `AVG`) — они доступны только позже.
* Пример:

```sql
WHERE e.salary > 50000
```


***

## Группировка (Grouped — GROUP BY)

* Строки объединяются в группы по указанным полям.
* Пример:

```sql
GROUP BY d.name
```


***

## Фильтрация групп (Filtered — HAVING)

* Применяются условия к результатам агрегации.
* В отличие от `WHERE`, можно использовать агрегатные функции.
* Пример:

```sql
HAVING AVG(e.salary) > 60000
```


***

## Выборка (Selected — SELECT)

* Формируется окончательный набор колонок.
* Здесь применяются:
  * вычисляемые поля,
  * агрегатные функции,
  * `DISTINCT`.
* Пример:

```sql
SELECT d.name, AVG(e.salary) AS avg_salary
```


***

## Сортировка (Ordered — ORDER BY)

* Результаты сортируются по указанным столбцам или вычисленным выражениям.
* Пример:

```sql
ORDER BY avg_salary DESC
```


***

## Ограничение выборки (Limited — LIMIT / OFFSET)

* Устанавливается ограничение по числу строк.
* Пример:

```sql
LIMIT 10 OFFSET 20
```

