# üìò –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ SQL (PostgreSQL)

* **–ê–≥—Ä–µ–≥–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫** –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ**.
* –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫:
  * –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ (–µ—Å–ª–∏ –Ω–µ—Ç `GROUP BY`);
  * –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ (`GROUP BY` —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞).
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å–≤—è–∑–∫–µ —Å `GROUP BY` –∏ `HAVING`.





***

## COUNT

```sql
COUNT(*)             -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
COUNT(column)        -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ù–ï NULL –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ
COUNT(DISTINCT col)  -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
```

* `COUNT(*)` —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –≤–∫–ª—é—á–∞—è `NULL`.
* `COUNT(column)` –Ω–µ —Å—á–∏—Ç–∞–µ—Ç `NULL`.
* `COUNT(DISTINCT column)` —Å—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–µ–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SELECT COUNT(*) FROM employees;                 -- –≤—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
SELECT COUNT(salary) FROM employees;            -- —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∏–∑–≤–µ—Å—Ç–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç–æ–π
SELECT COUNT(DISTINCT department_id) FROM employees; -- —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤
```





***

## SUM –∏ AVG

```sql
SUM(column)   -- —Å—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π
AVG(column)   -- —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ
```

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SELECT SUM(salary), AVG(salary)
FROM employees
WHERE department_id = 10;
```





***

## MIN –∏ MAX

```sql
MIN(column)   -- –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
MAX(column)   -- –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SELECT MIN(salary), MAX(salary)
FROM employees;
```





***

## –ê–≥—Ä–µ–≥–∞—Ç—ã –¥–ª—è –±—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```sql
BOOL_AND(condition)   -- TRUE, –µ—Å–ª–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç —É—Å–ª–æ–≤–∏—é
BOOL_OR(condition)    -- TRUE, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—é
```

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SELECT BOOL_AND(salary > 3000),
       BOOL_OR(salary > 10000)
FROM employees;
```





***

## –°—Ç—Ä–æ–∫–æ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã

```sql
STRING_AGG(column, delimiter)   -- —Å–∫–ª–µ–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
ARRAY_AGG(column)               -- —Å–æ–±–∏—Ä–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤
```

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SELECT STRING_AGG(name, ', ')   -- "–ò–≤–∞–Ω–æ–≤, –ü–µ—Ç—Ä–æ–≤, –°–∏–¥–æ—Ä–æ–≤"
FROM employees;

SELECT ARRAY_AGG(department_id) -- {10,20,30}
FROM employees;
```





***

## –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è PostgreSQL

* `MODE()` ‚Äî –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–µ–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ.
* `VAR_POP`, `VAR_SAMP` ‚Äî –¥–∏—Å–ø–µ—Ä—Å–∏—è (–æ–±—â–∞—è, –≤—ã–±–æ—Ä–æ—á–Ω–∞—è).
* `STDDEV_POP`, `STDDEV_SAMP` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ.

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SELECT VAR_SAMP(salary), STDDEV_SAMP(salary)
FROM employees;
```





***

## –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è



**–í&#x20;****`SELECT`****&#x20;–±–µ–∑&#x20;****`GROUP BY`** ‚Äî –∞–≥—Ä–µ–≥–∞—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ.

```sql
SELECT COUNT(*) FROM employees;
```



**–°&#x20;****`GROUP BY`** ‚Äî –∞–≥—Ä–µ–≥–∞—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –æ—Ç–¥–µ–ª—å–Ω–æ.

```sql
SELECT department_id, AVG(salary)
FROM employees
GROUP BY department_id;
```



**–í&#x20;****`HAVING`** ‚Äî –∞–≥—Ä–µ–≥–∞—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≥—Ä—É–ø–ø.

```sql
SELECT department_id, COUNT(*)
FROM employees
GROUP BY department_id
HAVING COUNT(*) > 5;
```



**–í&#x20;****`WHERE`** –∞–≥—Ä–µ–≥–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–Ω–µ–ª—å–∑—è**.

```sql
SELECT name FROM employees
WHERE AVG(salary) > 5000; -- ‚ùå –æ—à–∏–±–∫–∞
```





***

## –¢–∞–±–ª–∏—Ü–∞ –ê–∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π PostgreSQL

| –§—É–Ω–∫—Ü–∏—è                              | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –ü—Ä–∏–º–µ—Ä                                                |
| ------------------------------------ | ------------------------------------------------------ | ----------------------------------------------------- |
| **COUNT(\*)**                        | –ö–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ (–≤–∫–ª—é—á–∞—è `NULL`)                          | `COUNT(*)`                                            |
| **COUNT(col)**                       | –ö–æ–ª-–≤–æ –Ω–µ–ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ                     | `COUNT(salary)`                                       |
| **COUNT(DISTINCT col)**              | –ö–æ–ª-–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π                             | `COUNT(DISTINCT department_id)`                       |
| **SUM(col)**                         | –°—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π                                         | `SUM(salary)`                                         |
| **AVG(col)**                         | –°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ                                 | `AVG(salary)`                                         |
| **MIN(col)**                         | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ                                   | `MIN(salary)`                                         |
| **MAX(col)**                         | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ                                  | `MAX(salary)`                                         |
| **BOOL\_AND(condition)**             | `TRUE`, –µ—Å–ª–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç —É—Å–ª–æ–≤–∏—é          | `BOOL_AND(salary > 3000)`                             |
| **BOOL\_OR(condition)**              | `TRUE`, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—é | `BOOL_OR(salary > 10000)`                             |
| **STRING\_AGG(col, delim)**          | –°–∫–ª–µ–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º                        | `STRING_AGG(name, ', ')` ‚Üí `–ò–≤–∞–Ω–æ–≤, –ü–µ—Ç—Ä–æ–≤`           |
| **ARRAY\_AGG(col)**                  | –°–æ–±–∏—Ä–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤                             | `ARRAY_AGG(department_id)` ‚Üí `{10,20,30}`             |
| **MODE() WITHIN GROUP**              | –ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–µ–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ                  | `MODE() WITHIN GROUP (ORDER BY salary)`               |
| **VAR\_POP(col)**                    | –û–±—â–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è                                        | `VAR_POP(salary)`                                     |
| **VAR\_SAMP(col)**                   | –í—ã–±–æ—Ä–æ—á–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è                                   | `VAR_SAMP(salary)`                                    |
| **STDDEV\_POP(col)**                 | –û–±—â–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ                           | `STDDEV_POP(salary)`                                  |
| **STDDEV\_SAMP(col)**                | –í—ã–±–æ—Ä–æ—á–Ω–æ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ                      | `STDDEV_SAMP(salary)`                                 |
| **PERCENTILE\_CONT(p) WITHIN GROUP** | –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å (–∫–≤–∞–Ω—Ç–∏–ª—å)                      | `PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY salary)` |
| **PERCENTILE\_DISC(p) WITHIN GROUP** | –î–∏—Å–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å                                  | `PERCENTILE_DISC(0.5) WITHIN GROUP (ORDER BY salary)` |



