# üìò HAVING –≤ SQL

* `HAVING` ‚Äî —ç—Ç–æ —Ñ–∏–ª—å—Ç—Ä –¥–ª—è **–≥—Ä—É–ø–ø —Å—Ç—Ä–æ–∫**, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `GROUP BY`.
* –†–∞–±–æ—Ç–∞–µ—Ç **–ø–æ—Å–ª–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏** (`COUNT`, `SUM`, `AVG`, `MAX`, `MIN` –∏ —Ç. –¥.).
* –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `WHERE` (–∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –¥–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏), `HAVING` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏**.



`HAVING` **–≤—Å–µ–≥–¥–∞ –ø–∏—à–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑** –≤ –∑–∞–ø—Ä–æ—Å–µ, –Ω–æ **–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º, –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –ø–æ—Å–ª–µ&#x20;****`GROUP BY`**.

* –¢–æ –µ—Å—Ç—å:
  1. –°–Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –≥—Ä—É–ø–ø—ã (`GROUP BY`).
  2. –ü–æ—Ç–æ–º –∫–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ–º `HAVING`.
  3. –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ª–æ–≤–∏–µ ‚Äî –æ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.





***

## –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä (–æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)

–ü–æ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–º –æ—Ç–¥–µ–ª–µ, –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ —Ç–µ –æ—Ç–¥–µ–ª—ã, –≥–¥–µ –∏—Ö –±–æ–ª—å—à–µ 5:

```sql
SELECT department_id, COUNT(*) AS num_employees
FROM employees
GROUP BY department_id
HAVING COUNT(*) > 5;
```

* `GROUP BY department_id` ‚Äî —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –ø–æ –æ—Ç–¥–µ–ª–∞–º.
* `HAVING COUNT(*) > 5` ‚Äî –æ—Ç–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã, –≥–¥–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–æ–ª—å—à–µ 5.





***

## –ü—Ä–∏–º–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞–º–∏

–ú–æ–∂–Ω–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ **–Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–æ–ª–æ–Ω–∫–∞–º**:

```sql
SELECT department_id, job_id, AVG(salary) AS avg_salary
FROM employees
GROUP BY department_id, job_id
HAVING AVG(salary) > 50000;
```

* –°–Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è **–ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏** (`department_id`, `job_id`).
* `HAVING` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–∞–∫–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª–∞—Ö, –≥–¥–µ —Å—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ > 50 000.





***

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ `WHERE` –∏ `HAVING`

```sql
-- WHERE —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –î–û –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
SELECT department_id, COUNT(*)
FROM employees
WHERE salary > 40000   -- –∏—Å–∫–ª—é—á–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –º–∞–ª–µ–Ω—å–∫–æ–π –ó–ü
GROUP BY department_id;

-- HAVING —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≥—Ä—É–ø–ø—ã –ü–û–°–õ–ï –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
SELECT department_id, COUNT(*)
FROM employees
GROUP BY department_id
HAVING AVG(salary) > 40000;  -- –∏—Å–∫–ª—é—á–∏–º —Ü–µ–ª—ã–µ –æ—Ç–¥–µ–ª—ã

```

‚ö° –†–∞–∑–Ω–∏—Ü–∞:

* `WHERE` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
* `HAVING` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≥—Ä—É–ø–ø—ã –ø–æ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º.





***

## HAVING –±–µ–∑ GROUP BY

–î–∞, –º–æ–∂–Ω–æ! –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –≤—Å—è —Ç–∞–±–ª–∏—Ü–∞ ‚Äî —ç—Ç–æ **–æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞**:

```sql
SELECT COUNT(*) AS total_employees
FROM employees
HAVING COUNT(*) > 100;
```

* –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –º–µ–Ω—å—à–µ 100, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π.
* –ï—Å–ª–∏ –±–æ–ª—å—à–µ ‚Äî –≤–µ—Ä–Ω—ë—Ç—Å—è —á–∏—Å–ª–æ.





***

## –ù–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–≤–∏–π –≤ HAVING

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AND`, `OR`, –∫–∞–∫ –≤ `WHERE`:

```sql
SELECT department_id, COUNT(*) AS num_employees, AVG(salary) AS avg_salary
FROM employees
GROUP BY department_id
HAVING COUNT(*) > 5
   AND AVG(salary) > 60000;
```





***

## –ß—Ç–æ –º–æ–∂–Ω–æ –∞ —á—Ç–æ –Ω–µ–ª—å–∑—è

| –°–ª—É—á–∞–π                                                              | –ü—Ä–∏–º–µ—Ä                                                                                                                            | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ                                                         |
| ------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| ‚úÖ **–ê–≥—Ä–µ–≥–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è**                                            | `sql SELECT department_id, COUNT(*) FROM employees GROUP BY department_id HAVING COUNT(*) > 5; `                                  | –§–∏–ª—å—Ç—Ä—É–µ–º –≥—Ä—É–ø–ø—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–æ–∫                               |
| ‚úÖ **–ü–æ–ª–µ –∏–∑&#x20;****`GROUP BY`**                                   | `sql SELECT department_id, COUNT(*) FROM employees GROUP BY department_id HAVING department_id > 50; `                            | –ú–æ–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ `department_id` –æ–¥–∏–Ω–∞–∫–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã    |
| ‚ùå **–ü–æ–ª–µ –≤–Ω–µ&#x20;****`GROUP BY`****&#x20;–∏ –±–µ–∑ –∞–≥—Ä–µ–≥–∞—Ç–∞**          | `sql SELECT department_id, COUNT(*) FROM employees GROUP BY department_id HAVING salary > 50000; `                                | `salary` –Ω–µ —É–Ω–∏–∫–∞–ª–µ–Ω –≤ –≥—Ä—É–ø–ø–µ ‚Üí SQL –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—Ä–∞—Ç—å |
| ‚úÖ **–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –ø–æ–ª–µ–π**                   | `sql SELECT department_id, AVG(salary) FROM employees GROUP BY department_id HAVING department_id > 10 AND AVG(salary) > 60000; ` | –£—Å–ª–æ–≤–∏–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ: —á–∞—Å—Ç—å –ø–æ `department_id`, —á–∞—Å—Ç—å –ø–æ –∞–≥—Ä–µ–≥–∞—Ç—É     |
| ‚úÖ **HAVING –±–µ–∑ GROUP BY (–æ–¥–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞)**                 | `sql SELECT COUNT(*) FROM employees HAVING COUNT(*) > 0; `                                                                        | –°—á–∏—Ç–∞–µ—Ç—Å—è, —á—Ç–æ –≤—Å—è —Ç–∞–±–ª–∏—Ü–∞ = –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞                           |
| ‚ö† **HAVING –±–µ–∑ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ –±–µ–∑ GROUP BY (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ)** | `sql SELECT 1 HAVING 2 > 1; `                                                                                                     | –¢–∞–∫–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ. –§–∏–ª—å—Ç—Ä –¥–ª—è "–æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã"   |



