# üìò –°—Å—ã–ª–æ—á–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (Referential Integrity)

**–°—Å—ã–ª–æ—á–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤–æ **–≤–Ω–µ—à–Ω–µ–º –∫–ª—é—á–µ (FOREIGN KEY)** —Ç–∞–±–ª–∏—Ü—ã –≤—Å–µ–≥–¥–∞ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ **–ø–µ—Ä–≤–∏—á–Ω–æ–º (PRIMARY KEY)** –∏–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º (UNIQUE) –∫–ª—é—á–µ –¥—Ä—É–≥–æ–π —Ç–∞–±–ª–∏—Ü—ã.

‚û°Ô∏è –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: –Ω–µ–ª—å–∑—è —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å.



–°—Å—ã–ª–æ—á–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å:

* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ¬´–≤–∏—Å—è—á–∏–µ —Å—Å—ã–ª–∫–∏¬ª (orphan records).
* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫—É—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏.
* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–≤—è–∑–µ–π **¬´–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º¬ª** –∏ **¬´–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º¬ª**.
* –£–ø—Ä–æ—â–∞–µ—Ç —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.





***

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

–ü—É—Å—Ç—å –µ—Å—Ç—å –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã:

* **Parent (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è)** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º.
* **Child (–¥–æ—á–µ—Ä–Ω—è—è)** ‚Äî —Ç–∞–±–ª–∏—Ü–∞, —Å—Å—ã–ª–∞—é—â–∞—è—Å—è –Ω–∞ Parent.

**–ü—Ä–∞–≤–∏–ª–∞:**

1. –í `Child` –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
   * –∑–Ω–∞—á–µ–Ω–∏–µ, —Ä–∞–≤–Ω–æ–µ –æ–¥–Ω–æ–º—É –∏–∑ –∫–ª—é—á–µ–π –≤ `Parent`;
   * –∏–ª–∏ NULL (–µ—Å–ª–∏ —ç—Ç–æ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è).
2. –í `Parent` –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å, –µ—Å–ª–∏ –Ω–∞ –Ω–µ—ë –≤—Å—ë –µ—â—ë —Å—Å—ã–ª–∞—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ –≤ `Child` (–∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —è–≤–Ω–æ –∑–∞–¥–∞–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏).





***

## –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≤ PostgreSQL



### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FOREIGN KEY

* –û—Å–Ω–æ–≤–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –°–£–ë–î –ø—Ä–∏ `INSERT`, `UPDATE`, `DELETE`.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE TABLE department (
    dept_id SERIAL PRIMARY KEY,
    dept_name TEXT NOT NULL
);

CREATE TABLE employee (
    emp_id SERIAL PRIMARY KEY,
    emp_name TEXT NOT NULL,
    dept_id INT REFERENCES department(dept_id)
);
```

–ó–¥–µ—Å—å `employee.dept_id` **–Ω–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ `department.dept_id`.



### –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —Å—Å—ã–ª–æ–∫

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ FOREIGN KEY –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE employee (
    emp_id SERIAL PRIMARY KEY,
    emp_name TEXT NOT NULL,
    dept_id INT REFERENCES department(dept_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

–í–∞—Ä–∏–∞–Ω—Ç—ã:

| –ü—Ä–∞–≤–∏–ª–æ                        | –ó–Ω–∞—á–µ–Ω–∏–µ                                                                            |
| ------------------------------ | ----------------------------------------------------------------------------------- |
| `ON DELETE / UPDATE RESTRICT`  | –ó–∞–ø—Ä–µ—â–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º—ã–µ —Å—Ç—Ä–æ–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).           |
| `ON DELETE / UPDATE NO ACTION` | –¢–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.                         |
| `ON DELETE CASCADE`            | –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ –∏–∑ Parent –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ Child. |
| `ON UPDATE CASCADE`            | –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–ª—é—á–∞ –≤ Parent –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –≤ Child.           |
| `ON DELETE SET NULL`           | –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ Parent –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –≤ Child —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `NULL`.                  |
| `ON UPDATE SET NULL`           | –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Parent –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –≤ Child —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `NULL`.                       |
| `ON DELETE SET DEFAULT`        | –í Child –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.                                        |
| `ON UPDATE SET DEFAULT`        | –¢–æ –∂–µ —Å–∞–º–æ–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.                                                         |



### –ò–Ω–¥–µ–∫—Å—ã

* –î–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç **–∏–Ω–¥–µ–∫—Å –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ** (–Ω–∞ referenced –∫–æ–ª–æ–Ω–∫—É), —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.
* –î–ª—è –¥–æ—á–µ—Ä–Ω–µ–π —Ç–∞–±–ª–∏—Ü—ã –∏–Ω–¥–µ–∫—Å –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ —á–∞—Å—Ç–æ –ø–æ–ª–µ–∑–µ–Ω (—É—Å–∫–æ—Ä—è–µ—Ç JOIN –∏ –∫–∞—Å–∫–∞–¥–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏).



### –¢—Ä–∏–≥–≥–µ—Ä—ã

* PostgreSQL —Ä–µ–∞–ª–∏–∑—É–µ—Ç `FOREIGN KEY` —á–µ—Ä–µ–∑ **—Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã**.
* –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª).



### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (DEFERRABLE)

* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é FOREIGN KEY –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **—Å—Ä–∞–∑—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏**.
* –ù–æ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å **DEFERRABLE INITIALLY DEFERRED**, —Ç–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ **–≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE TABLE employee (
    emp_id INT PRIMARY KEY,
    dept_id INT REFERENCES department(dept_id)
        DEFERRABLE INITIALLY DEFERRED
);
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è, –∞ –ø–æ—Ç–æ–º –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å—Å—ã–ª–æ—á–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å.





***

## –ü—Ä–∏–º–µ—Ä—ã



–ü—Ä–∏–º–µ—Ä 1 ‚Äî –ó–∞–ø—Ä–µ—â—ë–Ω–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞:

```sql
INSERT INTO employee (emp_name, dept_id) VALUES ('Alice', 999);
-- –û—à–∏–±–∫–∞: –∫–ª—é—á (dept_id) –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ department
```



–ü—Ä–∏–º–µ—Ä 2 ‚Äî ON DELETE CASCADE:

```sql
DELETE FROM department WHERE dept_id = 1;
-- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—Å—è –≤—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ –æ—Ç–¥–µ–ª–∞ 1
```



–ü—Ä–∏–º–µ—Ä 3 ‚Äî ON DELETE SET NULL:

```sql
DELETE FROM department WHERE dept_id = 2;
-- –≤—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ç–¥–µ–ª–∞ 2 —Ç–µ–ø–µ—Ä—å –±—É–¥—É—Ç –∏–º–µ—Ç—å dept_id = NULL
```



