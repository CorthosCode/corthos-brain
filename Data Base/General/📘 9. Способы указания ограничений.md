
–í PostgreSQL (–∏ –≤–æ–æ–±—â–µ –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö –°–£–ë–î) –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (**constraints**) –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å **—Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏**.

–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–ª—è—Ç—Å—è –Ω–∞ 2 –±–æ–ª—å—à–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

* **–ù–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç–æ–ª–±—Ü–∞ (column-level)** ‚Äî —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è.
* **–ù–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã (table-level)** ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã.


***

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç–æ–ª–±—Ü–∞

–ó–∞–¥–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö.

–û–±—ã—á–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Å—Ç–æ–ª–±—Ü—É.

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,        -- PK –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç–æ–ª–±—Ü–∞
    name TEXT NOT NULL,           -- NOT NULL
    email TEXT UNIQUE,            -- UNIQUE
    salary NUMERIC CHECK (salary > 0)  -- CHECK
);
```

üëâ –ó–¥–µ—Å—å:

* `PRIMARY KEY`, `NOT NULL`, `UNIQUE`, `CHECK` —É–∫–∞–∑–∞–Ω—ã –ø—Ä—è–º–æ —Ä—è–¥–æ–º —Å –∫–æ–ª–æ–Ω–∫–æ–π.


***

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã

–û–±—ä—è–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫.

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:

* —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö) –∫–ª—é—á–µ–π,
* —Å—Å—ã–ª–æ–∫ (`FOREIGN KEY`),
* —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (`CHECK`),
* `EXCLUSION`.

```sql
CREATE TABLE orders (
    order_id SERIAL,
    customer_id INT,
    product_id INT,
    quantity INT,
    
    PRIMARY KEY (order_id, product_id),  -- —Å–æ—Å—Ç–∞–≤–Ω–æ–π PK
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE,
    UNIQUE (product_id, customer_id),    -- —Å–æ—Å—Ç–∞–≤–Ω–æ–π UNIQUE
    CHECK (quantity > 0)                 -- —É—Å–ª–æ–≤–∏–µ
);
```


***

## –Ø–≤–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

–ö–∞–∂–¥–æ–º—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—é –º–æ–∂–Ω–æ –¥–∞—Ç—å –∏–º—è (`CONSTRAINT –∏–º—è`).

–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–∏ (`ALTER TABLE ‚Ä¶ DROP CONSTRAINT ‚Ä¶`).

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price NUMERIC,
    CONSTRAINT positive_price CHECK (price > 0),
    CONSTRAINT unique_id UNIQUE (id)
);
```


***

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã (ALTER TABLE)

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ:

```sql
ALTER TABLE employees
    ADD CONSTRAINT email_unique UNIQUE (email);

ALTER TABLE employees
    ADD CONSTRAINT positive_salary CHECK (salary > 0);
```


***

## –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (DEFERRABLE)

–í PostgreSQL –º–æ–∂–Ω–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

–≠—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ–∏—à–∫–∞ PostgreSQL.

```sql
CREATE TABLE accounts (
    id SERIAL PRIMARY KEY,
    balance NUMERIC CHECK (balance >= 0) DEFERRABLE INITIALLY DEFERRED
);
```

* `DEFERRABLE` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–∞.
* `INITIALLY DEFERRED` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞ –Ω–µ –Ω–∞ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

üëâ –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ –¥–µ–Ω–µ–≥ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ (—á—Ç–æ–±—ã –±–∞–ª–∞–Ω—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–≥ –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏).


***

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **–∏–Ω–¥–µ–∫—Å—ã**:

* `UNIQUE` ‚Üí —Å–æ–∑–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å.
* `EXCLUSION` ‚Üí —Ç—Ä–µ–±—É–µ—Ç **–∏–Ω–¥–µ–∫—Å GIST** –∏–ª–∏ **SP-GiST**.

```sql
CREATE TABLE bookings (
    room_id INT,
    during TSRANGE,
    EXCLUDE USING gist (
        room_id WITH =,
        during WITH &&
    )
);
```

