
В PostgreSQL (как и в большинстве реляционных СУБД) для обеспечения целостности данных используются **ограничения (constraints)**.

Они задаются на уровне таблицы и контролируются автоматически при `INSERT` / `UPDATE`.


***

## NOT NULL

Запрещает хранить `NULL` в колонке.

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,   -- имя не может быть пустым
    salary NUMERIC
);
```


***

## UNIQUE

Гарантирует уникальность значений в колонке или комбинации колонок.

```sql
CREATE TABLE users (
    email TEXT UNIQUE,    -- нельзя завести двух пользователей с одним email
    phone TEXT
);
```


***

## PRIMARY KEY

* То же самое, что `UNIQUE + NOT NULL`.
* Обычно используется для идентификатора строки.
* Может быть составным (из нескольких колонок).

```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INT NOT NULL
);
```


***

## FOREIGN KEY (Ссылочная целостность)

Гарантирует, что значение в колонке существует в другой таблице.

```sql
CREATE TABLE customers (
    id SERIAL PRIMARY KEY,
    name TEXT
);

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_id INT REFERENCES customers(id)  -- ссылка на клиента
);
```

Дополнительно можно задать поведение при удалении/обновлении: `ON DELETE CASCADE`, `ON UPDATE CASCADE`, `SET NULL`, `SET DEFAULT`, `RESTRICT`.


***

## CHECK

Позволяет задать условие для проверки данных.

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price NUMERIC CHECK (price > 0),  -- цена должна быть положительной
    discount NUMERIC CHECK (discount BETWEEN 0 AND 100)
);
```


***

## EXCLUSION (Только в PostgreSQL)

Более продвинутый вариант `UNIQUE`.

Позволяет запретить пересечения значений по условию (часто используется с диапазонами и геометрией).

Пример: нельзя бронировать один и тот же ресурс на пересекающийся временной интервал:

```sql
CREATE TABLE bookings (
    room_id INT,
    during TSRANGE,  -- диапазон времени
    EXCLUDE USING gist (
        room_id WITH =,
        during WITH &&
    )
);
```

Здесь `&&` — оператор пересечения диапазонов.


***

## Сводная таблица

| Ограничение     | Назначение                                                              |
| --------------- | ----------------------------------------------------------------------- |
| **NOT NULL**    | Запрещает `NULL`                                                        |
| **UNIQUE**      | Гарантирует уникальность значений                                       |
| **PRIMARY KEY** | Идентификатор строки (`NOT NULL + UNIQUE`)                              |
| **FOREIGN KEY** | Проверяет ссылочную целостность (значение должно быть в другой таблице) |
| **CHECK**       | Условная проверка значений                                              |
| **EXCLUSION**   | Исключает конфликтующие значения (диапазоны, геометрия и др.)           |

