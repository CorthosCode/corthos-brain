# üìò –û–±–æ–±—â–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

–£ –ª—é–±–æ–π –°–£–ë–î –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å **–æ–±–æ–±—â—ë–Ω–Ω—É—é —Å—Ö–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞** ‚Äî –ø—É—Ç—å –æ—Ç —Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞, –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª `SELECT ...`, –¥–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.





***

## –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –°–£–ë–î



### 1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è / –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

* –ó–∞–ø—Ä–æ—Å –ø–æ—Å—Ç—É–ø–∞–µ—Ç –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞ (psql, PgAdmin, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Python/Java —á–µ—Ä–µ–∑ –¥—Ä–∞–π–≤–µ—Ä).
* –ß–µ—Ä–µ–∑ **frontend/backend –ø—Ä–æ—Ç–æ–∫–æ–ª** –∑–∞–ø—Ä–æ—Å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–µ—Ä–≤–µ—Ä PostgreSQL.



### 2. **–ü–∞—Ä—Å–µ—Ä (Parsing)**

* SQL-—Ç–µ–∫—Å—Ç —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ **–ª–µ–∫—Å–µ–º—ã** (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü, —Å—Ç–æ–ª–±—Ü–æ–≤, –ª–∏—Ç–µ—Ä–∞–ª—ã).
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **—Å–∏–Ω—Ç–∞–∫—Å–∏—Å** (–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ SQL).
* –†–µ–∑—É–ª—å—Ç–∞—Ç: **–¥–µ—Ä–µ–≤–æ —Ä–∞–∑–±–æ—Ä–∞ (parse tree)**.

üëâ –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤ SQL ‚Äî –æ–Ω–∞ –ª–æ–≤–∏—Ç—Å—è –∑–¥–µ—Å—å (`syntax error`).



### 3. **–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä / –ü–µ—Ä–µ–ø–∏—Å—á–∏–∫ (Analyzer/Rewrite)**

* –ü—Ä–æ–≤–µ—Ä–∫–∞ **—Å–µ–º–∞–Ω—Ç–∏–∫–∏**:
  * —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ –∫–æ–ª–æ–Ω–∫–∏;
  * –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∞–≤–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø;
  * –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
* –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è **–ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è (rewrite rules)**:
  * —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views)**;
  * —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç **INSTEAD OF —Ç—Ä–∏–≥–≥–µ—Ä—ã**.

–†–µ–∑—É–ª—å—Ç–∞—Ç: **–ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∑–∞–ø—Ä–æ—Å–∞**.



### 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä (Optimizer/Planner)**

* –°–∞–º—ã–π —É–º–Ω—ã–π —ç—Ç–∞–ø: –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è **–ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.
* –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã:
  * –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã (Seq Scan),
  * –∏–Ω–¥–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫ (Index Scan),
  * —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Nested Loop, Hash Join, Merge Join),
  * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.
* –ù–∞ –æ—Å–Ω–æ–≤–µ **—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (ANALYZE)** –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è **–æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** (cost-based optimizer).

–†–µ–∑—É–ª—å—Ç–∞—Ç: **query execution plan**.



### 5. **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (Executor)**

* –ü–ª–∞–Ω –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏.
* –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º:
  * –≤—ã–±–æ—Ä–∫–∞ —Å—Ç—Ä–æ–∫,
  * —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (`WHERE`),
  * —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (`JOIN`),
  * –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (`GROUP BY`),
  * —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (`ORDER BY`).
* –î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ **–±—É—Ñ–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞** (–∏–ª–∏ —á–∏—Ç–∞—é—Ç—Å—è —Å –¥–∏—Å–∫–∞ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–º—è—Ç–∏).
* –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∑–º—ã **MVCC** (–∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç ¬´—Å–≤–æ–π —Å–Ω–∏–º–æ–∫¬ª –¥–∞–Ω–Ω—ã—Ö).

–†–µ–∑—É–ª—å—Ç–∞—Ç: **—Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (tuples)**.



### 6. **–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**

* Executor –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –∫–ª–∏–µ–Ω—Ç—É –ø–æ—Ä—Ü–∏—è–º–∏ (–∫—É—Ä—Å–æ—Ä–Ω–∞—è –º–æ–¥–µ–ª—å).
* –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON –∏ —Ç.–¥.).





***

## –°—Ö–µ–º–∞ (–æ–±–æ–±—â—ë–Ω–Ω–∞—è)

```
SQL-–∑–∞–ø—Ä–æ—Å
   ‚îÇ
   ‚ñº
–ü–∞—Ä—Å–µ—Ä  ‚îÄ‚îÄ‚ñ∫  –î–µ—Ä–µ–≤–æ —Ä–∞–∑–±–æ—Ä–∞
   ‚îÇ
   ‚ñº
–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä/–ü–µ—Ä–µ–ø–∏—Å—á–∏–∫ ‚îÄ‚îÄ‚ñ∫ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ
   ‚îÇ
   ‚ñº
–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä ‚îÄ‚îÄ‚ñ∫ –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   ‚îÇ
   ‚ñº
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ‚îÄ‚îÄ‚ñ∫ –†–µ–∑—É–ª—å—Ç–∞—Ç (tuples/—Å—Ç—Ä–æ–∫–∏)
   ‚îÇ
   ‚ñº
–ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```





***

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤ PostgreSQL

* –£ PostgreSQL **–∫–∞–∂–¥–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ = –æ—Ç–¥–µ–ª—å–Ω—ã–π backend-–ø—Ä–æ—Ü–µ—Å—Å**.
* –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ PostgreSQL –º–æ–∂–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å **–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –ø–ª–∞–Ω—ã** (—Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏, CTE).
* –ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω —á–µ—Ä–µ–∑:

```sql
EXPLAIN SELECT ...;
EXPLAIN ANALYZE SELECT ...;
```



