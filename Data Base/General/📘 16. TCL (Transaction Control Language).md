
**TCL (Transaction Control Language)** ‚Äî —ç—Ç–æ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ SQL-–∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è = –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å SQL-–æ–ø–µ—Ä–∞—Ü–∏–π, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –∫–∞–∫ **–æ–¥–Ω–æ —Ü–µ–ª–æ–µ**.
* –¶–µ–ª—å TCL ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ **ACID** (Atomicity, Consistency, Isolation, Durability).
* TCL —Ä–∞–±–æ—Ç–∞–µ—Ç **–ø–æ–≤–µ—Ä—Ö DML (INSERT, UPDATE, DELETE)** ‚Äî –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∏–ª–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è.


[[üìò ACID]]


***

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã TCL


### COMMIT

* –§–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
* –ü–æ—Å–ª–µ `COMMIT` –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è **–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏** –∏ –≤–∏–¥–∏–º—ã–º–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

üìå –ü—Ä–∏–º–µ—Ä:

```sql
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```

‚úÖ –î–µ–Ω—å–≥–∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã. –ï—Å–ª–∏ –±—ã –Ω–µ –±—ã–ª–æ `COMMIT` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–∞–ª–∏ –±—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏.


### ROLLBACK

* –û—Ç–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
* –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ë–î –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é **–¥–æ –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –∏–ª–∏ –¥–æ **SAVEPOINT**.

üìå –ü—Ä–∏–º–µ—Ä:

```sql
BEGIN;
DELETE FROM employees WHERE dept_id = 10;
ROLLBACK;
```

‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.


### SAVEPOINT

* –°–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–æ—á–∫—É –æ—Ç–∫–∞—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å—Ç–∏—á–Ω–æ, –∞ –Ω–µ –≤—Å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

üìå –ü—Ä–∏–º–µ—Ä:

```sql
BEGIN;

INSERT INTO log VALUES ('start');
SAVEPOINT sp1;

UPDATE products SET price = price * 0.9;
SAVEPOINT sp2;

DELETE FROM temp_data;
ROLLBACK TO sp2;  -- –æ—Ç–∫–∞—Ç —Ç–æ–ª—å–∫–æ —É–¥–∞–ª–µ–Ω–∏—è

COMMIT;  -- —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—Å—Ç–∞–≤–∫—É + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```


[[üìò SAVEPOINT –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è]]


### SET TRANSACTION

* –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏, –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ —Ç.–¥.
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤ –Ω–∞—á–∞–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.

üìå –ü—Ä–∏–º–µ—Ä:

```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN;
UPDATE accounts SET balance = balance - 50 WHERE id = 1;
COMMIT;
```


***

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)

1. **BEGIN** (–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–π DML-–æ–ø–µ—Ä–∞—Ü–∏–∏).
2. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ–º–∞–Ω–¥—ã `INSERT`, `UPDATE`, `DELETE`.
3. –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
   * ‚úÖ `COMMIT` ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.
   * ‚ùå `ROLLBACK` ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω—è—é—Ç—Å—è.
   * ‚öñÔ∏è `SAVEPOINT` ‚Üí –º–æ–∂–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å.


[[üìò –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏]]


***

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

* –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –°–£–ë–î (PostgreSQL, Oracle) —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º DML.
* –í MySQL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á—ë–Ω **autocommit = ON** (–∫–∞–∂–¥—ã–π DML —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É). –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TCL ‚Äî –Ω–∞–¥–æ –æ—Ç–∫–ª—é—á–∏—Ç—å:

```sql
SET autocommit = 0;
```

TCL **–Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç DDL** (CREATE, DROP, ALTER):

* –í PostgreSQL ‚Äî DDL –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å.
* –í MySQL ‚Äî –º–Ω–æ–≥–∏–µ DDL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—é—Ç `COMMIT`.

