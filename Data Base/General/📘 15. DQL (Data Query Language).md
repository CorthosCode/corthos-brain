
**DQL (Data Query Language)** ‚Äî –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ SQL, –æ—Ç–≤–µ—á–∞—é—â–µ–µ **–∑–∞ –≤—ã–±–æ—Ä–∫—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã**.

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞:
* `SELECT` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –∏ —Ç.–¥.).

[[üìò –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SELECT-–∑–∞–ø—Ä–æ—Å–∞ –≤ SQL]]


***

## –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `SELECT`

```sql
SELECT [DISTINCT] column1, column2, ...
FROM table_name
[WHERE condition]
[GROUP BY column]
[HAVING condition]
[ORDER BY column [ASC|DESC]]
[LIMIT n] [OFFSET m];
```


***

## –ü—Ä–æ—Å—Ç–∞—è –≤—ã–±–æ—Ä–∫–∞

```sql
SELECT name, age FROM users;
```


***

## –ü—Å–µ–≤–¥–æ–Ω–∏–º—ã (`AS`)

```sql
SELECT name AS full_name, age AS years
FROM users;
```


***

## DISTINCT (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)

```sql
SELECT DISTINCT country FROM users;
```


[[üìò DISTINCT –≤ SQL]]


***

## WHERE ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

```sql
SELECT * FROM users WHERE age > 18;
```

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã:**

* `=` , `!=`, `<>`, `<`, `<=`, `>`, `>=`
* `BETWEEN x AND y`
* `IN (..)`
* `LIKE`, `ILIKE` (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ)
* `IS NULL`, `IS NOT NULL`

–ü—Ä–∏–º–µ—Ä:

```sql
SELECT * FROM users WHERE email LIKE '%gmail.com';
```


***

## ORDER BY ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–û–ø–µ—Ä–∞—Ç–æ—Ä ORDER BY –≤ SQL –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞ –ø–æ –æ–¥–Ω–æ–º—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å—Ç–æ–ª–±—Ü–∞–º –≤ –ø–æ—Ä—è–¥–∫–µ **–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—è (ASC)** –∏–ª–∏ **—É–±—ã–≤–∞–Ω–∏—è (DESC)**. **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é**, –µ—Å–ª–∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ.

```sql
SELECT * FROM users ORDER BY age DESC, name ASC;
```


***

## LIMIT –∏ OFFSET (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)

`LIMIT` - **—É–∫–∞–∑—ã–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –Ω–∞–±–æ—Ä–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**.

`OFFSET` - **—É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≤—ã–±–æ—Ä–∫–∏** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

```sql
SELECT * FROM users ORDER BY id LIMIT 10 OFFSET 20;
```


***

## –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

* `COUNT(*)` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
* `SUM(col)` ‚Äî —Å—É–º–º–∞
* `AVG(col)` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ
* `MIN(col)`, `MAX(col)` ‚Äî –º–∏–Ω–∏–º—É–º/–º–∞–∫—Å–∏–º—É–º

–ü—Ä–∏–º–µ—Ä:

```sql
SELECT AVG(age) FROM users;
```


***

## GROUP BY ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞

```sql
SELECT country, COUNT(*) AS total
FROM users
GROUP BY country;
```


***

## HAVING ‚Äî —É—Å–ª–æ–≤–∏–µ –Ω–∞ –≥—Ä—É–ø–ø—ã

```sql
SELECT country, COUNT(*) AS total
FROM users
GROUP BY country
HAVING COUNT(*) > 5;
```


[[üìò HAVING –≤ SQL]]


***

## –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã

```sql
SELECT name FROM users
WHERE age > (SELECT AVG(age) FROM users);
```


***

## JOIN ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

* `INNER JOIN` ‚Äî –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
* `LEFT JOIN` ‚Äî –≤—Å–µ –∏–∑ –ª–µ–≤–æ–π, + —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∞
* `RIGHT JOIN` ‚Äî –≤—Å–µ –∏–∑ –ø—Ä–∞–≤–æ–π
* `FULL JOIN` ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
* `CROSS JOIN` ‚Äî –¥–µ–∫–∞—Ä—Ç–æ–≤–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–∏–º–µ—Ä:

```sql
SELECT u.name, o.amount
FROM users u
JOIN orders o ON u.id = o.user_id;
```


***

## UNION, INTERSECT, EXCEPT

* `UNION` ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏).
* `INTERSECT` ‚Äî –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ.
* `EXCEPT` ‚Äî —Ä–∞–∑–Ω–æ—Å—Ç—å.

```sql
SELECT name FROM users
UNION
SELECT name FROM admins;
```


[[üìò 3. –†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–∞–º–∏]]


***

## CASE ‚Äî —É—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

```sql
SELECT name,
       CASE 
           WHEN age < 18 THEN 'Child'
           WHEN age BETWEEN 18 AND 65 THEN 'Adult'
           ELSE 'Senior'
       END AS category
FROM users;
```


***

## –û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (WINDOW FUNCTIONS)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å PostgreSQL ‚Äî –º–æ—â–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

**–ü—Ä–∏–º–µ—Ä: –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫**

```sql
SELECT name, ROW_NUMBER() OVER (ORDER BY age) AS num
FROM users;
```

**–ü—Ä–∏–º–µ—Ä: —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ**

```sql
SELECT name, age,
       AVG(age) OVER (ORDER BY age ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg
FROM users;
```

**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

* `ROW_NUMBER()`, `RANK()`, `DENSE_RANK()`
* `LAG(col, n)` / `LEAD(col, n)`
* `SUM() OVER`, `AVG() OVER`, `COUNT() OVER`


***

## CTE (WITH) ‚Äî Common Table Expressions

* –£–¥–æ–±–Ω–æ –¥–ª—è —á–∏—Ç–∞–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (`WITH RECURSIVE`).

```sql
WITH avg_age AS (
    SELECT AVG(age) AS a FROM users
)
SELECT name FROM users, avg_age
WHERE users.age > avg_age.a;
```


***

## –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤—ã–±–æ—Ä–∫–∏ PostgreSQL

Postgres —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç SQL:

* `FETCH FIRST n ROWS ONLY` ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ `LIMIT`
* `DISTINCT ON (column)` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ –∫–æ–ª–æ–Ω–∫–µ

```sql
SELECT DISTINCT ON (country) name, age
FROM users
ORDER BY country, age DESC;
```


***

## –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Materialized Views)

–ü–æ–∑–≤–æ–ª—è—é—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:

```sql
CREATE MATERIALIZED VIEW top_users AS
SELECT * FROM users ORDER BY rating DESC LIMIT 100;
```

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:

```sql
REFRESH MATERIALIZED VIEW top_users;
```

