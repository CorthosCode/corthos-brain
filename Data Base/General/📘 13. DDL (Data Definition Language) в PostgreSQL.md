
**DDL (Data Definition Language)** — это группа SQL-команд, предназначенных для **определения и управления объектами базы данных**: таблицами, схемами, представлениями, индексами, последовательностями и т.д.

> В отличие от DML (Data Manipulation Language), который работает с данными, DDL управляет структурой базы.

Особенности DDL:
* выполняет **автоматический COMMIT** (изменения фиксируются сразу);
* влияет на схему БД;
* ошибки могут требовать ручного отката (например, через `DROP` или `ALTER`).


***

## Основные объекты, которыми управляет DDL

* **Схемы** (schemas)
* **Таблицы** (tables)
* **Ограничения (constraints)**
* **Индексы (indexes)**
* **Последовательности (sequences)**
* **Представления (views)**
* **Функции, триггеры, типы данных**


***

## `CREATE` — создание объектов


### Таблица

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    age INT CHECK (age >= 0),
    email VARCHAR(150) UNIQUE
);
```


### Схема

```sql
CREATE SCHEMA accounting;
```


### Индекс

```sql
CREATE INDEX idx_users_name ON users(name);
```


### Последовательность

```sql
CREATE SEQUENCE order_seq START 1 INCREMENT 1;
```


### Представление

```sql
CREATE VIEW adult_users AS
SELECT name, age FROM users WHERE age >= 18;
```


***

## `ALTER` — изменение объектов


### Таблица

```sql
-- добавить столбец
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

-- изменить тип данных
ALTER TABLE users ALTER COLUMN age TYPE SMALLINT;

-- переименовать столбец
ALTER TABLE users RENAME COLUMN phone TO phone_number;

-- удалить столбец
ALTER TABLE users DROP COLUMN email;
```


### Ограничения

```sql
ALTER TABLE users ADD CONSTRAINT chk_age CHECK (age < 120);
ALTER TABLE users DROP CONSTRAINT chk_age;
```


### Схемы, таблицы, индексы

```sql
ALTER SCHEMA accounting RENAME TO finance;
ALTER INDEX idx_users_name RENAME TO idx_name;
```


***

## `DROP` — удаление объектов


### Таблица

```sql
DROP TABLE users;
DROP TABLE IF EXISTS users;
```


### Схема

```sql
DROP SCHEMA accounting;
DROP SCHEMA accounting CASCADE; -- удалит все объекты внутри
```


### Индекс

```sql
DROP INDEX idx_users_name;
```


### Представление

```sql
DROP VIEW adult_users;
```


***

## `TRUNCATE` — очистка таблицы

Полностью очищает таблицу **без журналирования**, работает быстрее `DELETE`.

```sql
TRUNCATE TABLE users;
TRUNCATE TABLE users, orders RESTART IDENTITY CASCADE;
```

* `RESTART IDENTITY` — сбрасывает счётчики `SERIAL/SEQUENCE`.
* `CASCADE` — очищает таблицы, ссылающиеся на неё по FK.


***

## `COMMENT` — комментарии к объектам

```sql
COMMENT ON TABLE users IS 'Таблица с пользователями';
COMMENT ON COLUMN users.name IS 'Имя пользователя';
```


***

## `RENAME` — переименование объектов

```sql
ALTER TABLE users RENAME TO customers;
ALTER INDEX idx_users_name RENAME TO idx_customers_name;
```


***

## `GRANT / REVOKE` (частично относят к DDL)

Используются для управления доступом к объектам.

```sql
GRANT SELECT, INSERT ON users TO analyst;
REVOKE INSERT ON users FROM analyst;
```


***

## Особенности DDL в PostgreSQL

* Многие DDL-операции автоматически вызывают **COMMIT**.
* Можно использовать `CASCADE` и `RESTRICT` при удалении объектов.
* PostgreSQL поддерживает расширенные конструкции (`CREATE OR REPLACE VIEW`, `DROP IF EXISTS`, `ALTER ... RENAME`).
* Команды `COMMENT` и `RENAME` также считаются частью DDL.

