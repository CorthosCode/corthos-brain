# üìò DDL (Data Definition Language) –≤ PostgreSQL

**DDL (Data Definition Language)** ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ SQL-–∫–æ–º–∞–Ω–¥, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–ª—è **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: —Ç–∞–±–ª–∏—Ü–∞–º–∏, —Å—Ö–µ–º–∞–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏ –∏ —Ç.–¥.

> –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç DML (Data Manipulation Language), –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏, DDL —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –±–∞–∑—ã.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ DDL:

* –≤—ã–ø–æ–ª–Ω—è–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π COMMIT** (–∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É);
* –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ö–µ–º—É –ë–î;
* –æ—à–∏–±–∫–∏ –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `DROP` –∏–ª–∏ `ALTER`).





***

## –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç DDL

* **–°—Ö–µ–º—ã** (schemas)
* **–¢–∞–±–ª–∏—Ü—ã** (tables)
* **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (constraints)**
* **–ò–Ω–¥–µ–∫—Å—ã (indexes)**
* **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (sequences)**
* **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views)**
* **–§—É–Ω–∫—Ü–∏–∏, —Ç—Ä–∏–≥–≥–µ—Ä—ã, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**





***

## `CREATE` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤



### –¢–∞–±–ª–∏—Ü–∞

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    age INT CHECK (age >= 0),
    email VARCHAR(150) UNIQUE
);
```



### –°—Ö–µ–º–∞

```sql
CREATE SCHEMA accounting;
```



### –ò–Ω–¥–µ–∫—Å

```sql
CREATE INDEX idx_users_name ON users(name);
```



### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```sql
CREATE SEQUENCE order_seq START 1 INCREMENT 1;
```



### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

```sql
CREATE VIEW adult_users AS
SELECT name, age FROM users WHERE age >= 18;
```





***

## `ALTER` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤



### –¢–∞–±–ª–∏—Ü–∞

```sql
-- –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

-- –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
ALTER TABLE users ALTER COLUMN age TYPE SMALLINT;

-- –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—Ç–æ–ª–±–µ—Ü
ALTER TABLE users RENAME COLUMN phone TO phone_number;

-- —É–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü
ALTER TABLE users DROP COLUMN email;
```



### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```sql
ALTER TABLE users ADD CONSTRAINT chk_age CHECK (age < 120);
ALTER TABLE users DROP CONSTRAINT chk_age;
```



### –°—Ö–µ–º—ã, —Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã

```sql
ALTER SCHEMA accounting RENAME TO finance;
ALTER INDEX idx_users_name RENAME TO idx_name;
```





***

## `DROP` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤



### –¢–∞–±–ª–∏—Ü–∞

```sql
DROP TABLE users;
DROP TABLE IF EXISTS users;
```



### –°—Ö–µ–º–∞

```sql
DROP SCHEMA accounting;
DROP SCHEMA accounting CASCADE; -- —É–¥–∞–ª–∏—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –≤–Ω—É—Ç—Ä–∏
```



### –ò–Ω–¥–µ–∫—Å

```sql
DROP INDEX idx_users_name;
```



### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

```sql
DROP VIEW adult_users;
```





***

## `TRUNCATE` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã

–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É **–±–µ–∑ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è**, —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ `DELETE`.

```sql
TRUNCATE TABLE users;
TRUNCATE TABLE users, orders RESTART IDENTITY CASCADE;
```

* `RESTART IDENTITY` ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫–∏ `SERIAL/SEQUENCE`.
* `CASCADE` ‚Äî –æ—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, —Å—Å—ã–ª–∞—é—â–∏–µ—Å—è –Ω–∞ –Ω–µ—ë –ø–æ FK.





***

## `COMMENT` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ–±—ä–µ–∫—Ç–∞–º

```sql
COMMENT ON TABLE users IS '–¢–∞–±–ª–∏—Ü–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏';
COMMENT ON COLUMN users.name IS '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
```





***

## `RENAME` ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤

```sql
ALTER TABLE users RENAME TO customers;
ALTER INDEX idx_users_name RENAME TO idx_customers_name;
```





***

## `GRANT / REVOKE` (—á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–Ω–æ—Å—è—Ç –∫ DDL)

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–±—ä–µ–∫—Ç–∞–º.

```sql
GRANT SELECT, INSERT ON users TO analyst;
REVOKE INSERT ON users FROM analyst;
```





***

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ DDL –≤ PostgreSQL

* –ú–Ω–æ–≥–∏–µ DDL-–æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç **COMMIT**.
* –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CASCADE` –∏ `RESTRICT` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤.
* PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (`CREATE OR REPLACE VIEW`, `DROP IF EXISTS`, `ALTER ... RENAME`).
* –ö–æ–º–∞–Ω–¥—ã `COMMENT` –∏ `RENAME` —Ç–∞–∫–∂–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —á–∞—Å—Ç—å—é DDL.



