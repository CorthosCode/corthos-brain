
## 1. Общее понятие пирамиды тестирования

Пирамида тестирования — это концепция, предложенная Майком Кунсом (Mike Cohn), описывающая оптимальное соотношение различных типов автоматизированных тестов в проекте. Она помогает командам принимать обоснованные решения о распределении усилий на написание тестов.

**Цель пирамиды**:
- Обеспечить баланс между скоростью выполнения, надежностью и покрытием.
- Снизить стоимость поддержки и локализации ошибок.
- Ускорить обратную связь по качеству кода.

**Структура пирамиды (снизу вверх)**:
1. **Модульные (юнит) тесты** — наибольшая часть.
2. **Интеграционные тесты** — средняя часть.
3. **Сквозные (e2e) тесты** — наименьшая часть.


---

## 2. Юнит-тесты (Unit Tests)

**Описание**:
- Проверяют отдельные компоненты (методы, классы, функции) в изоляции.
- Не взаимодействуют с внешними системами (БД, файлы, сеть).
- Запускаются быстро, дают быструю обратную связь.

**Преимущества**:
- Легко писать и поддерживать.
- Высокая скорость выполнения.
- Помогают при рефакторинге.

**Пример**:

```java
@Test
void shouldReturnCorrectSum() {
    Calculator calc = new Calculator();
    int result = calc.add(2, 3);
    assertEquals(5, result);
}
```

**Используемые инструменты**:
- JUnit (Java), TestNG, Mockito, JUnit 5
- Kotlin: Kotlin Test (kotlin.test), MockK


---

## 3. Интеграционные тесты (Integration Tests)

**Описание**:
- Проверяют взаимодействие между компонентами системы (например, сервис + БД, API + БД).
- Тестируют работу с внешними зависимостями (БД, очереди, внешние API).
- Медленнее юнит-тестов, но важнее для проверки целостности системы.

**Пример**:

```java
@Test
void shouldSaveUserToDatabase() {
    User user = new User("John", "john@example.com");
    userRepository.save(user);
    assertThat(userRepository.findById(user.getId())).isNotNull();
}
```

**Типы интеграционных тестов**:
- С реальной БД (с использованием TestContainers, H2, Flyway).
- С моками внешних API (WireMock, MockServer).
- С реальными зависимостями (например, Redis, Kafka).

**Инструменты**:
- Spring Boot Test, TestContainers, WireMock, REST-assured, JUnit 5.


---

## 4. Сквозные/е2е тесты (End-to-End Tests)

**Описание**:
- Проверяют систему в целом "с конца до конца", как это делает пользователь.
- Имитируют реальные сценарии использования (например, регистрация, покупка, отправка письма).
- Самые медленные и хрупкие тесты.

**Пример**:
- Открытие сайта → ввод логина/пароля → нажатие кнопки → проверка перехода на главную страницу.

**Инструменты**:
- Selenium WebDriver, Cypress, Playwright, TestCafe.

**Недостатки**:
- Высокое время выполнения.
- Сложно поддерживать.
- Часто ломаются при изменении UI.


---

## 5. Дополнительные типы тестирования (не входят в классическую пирамиду, но важны)

**5.1. Компонентные тесты**
- Тестируют отдельные UI-компоненты (React, Vue и т.д.).
- Находятся между юнит и интеграционными тестами.
- Инструменты: Jest, React Testing Library, Storybook.

**5.2. Тесты API**
- Проверяют работу HTTP-эндпоинтов.
- Не тестируют UI, но проверяют логику на уровне контроллера/сервиса.
- Инструменты: REST-assured, Postman/Newman, Karate, JUnit + WebTestClient.

**5.3. Регрессионные тесты**
- Проверяют, что старый функционал не сломался при добавлении нового.
- Могут быть автоматизированы или выполняться вручную.

**5.4. Нагрузочные/производительностные тесты**
- Проверяют, как система ведет себя под нагрузкой.
- Инструменты: JMeter, Gatling, k6.

**5.5. Тесты безопасности**
- Проверяют уязвимости в системе (SQL-инъекции, XSS и т.д.).
- Инструменты: OWASP ZAP, SonarQube, Snyk.


---

## 6. Современные трактовки пирамиды

- **Пирамида тестирования по Google**:    
    - 70% юнит-тестов.
    - 20% интеграционных.
    - 10% e2e.

- **Обратная пирамида (Ice Cream Cone)** — антипаттерн:
    - Много e2e, мало юнитов → медленные и нестабильные билды.

- **Пирамида тестирования по Martin Fowler**:    
    - Поддерживает идею Кунса, но акцент на том, что e2e тесты должны быть минимальными и только для критичных сценариев.


---

## 7. Практические рекомендации

- **Пишите больше юнит-тестов** — они быстрые и помогают улучшить архитектуру.
- **Интеграционные тесты** — на уровне важных сценариев (например, сохранение в БД, вызов внешнего API).
- **E2E тесты** — только для критических пользовательских сценариев.
- Используйте **фикстуры** и **Test Data Builders** для подготовки данных.
- **Mock-объекты** — для изоляции тестируемого кода.
- **TestContainers** — для тестирования с реальными зависимостями (например, БД, Redis) в Docker.

