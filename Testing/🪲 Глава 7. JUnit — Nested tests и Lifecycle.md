# ü™≤ –ì–ª–∞–≤–∞ 7. JUnit ‚Äî Nested tests –∏ Lifecycle

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–æ–≤ –≤ JUnit 5

JUnit –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è **–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –æ—á–∏—Å—Ç–∫–æ–π** –≤ —Ç–µ—Å—Ç–∞—Ö:

* `@BeforeAll` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ —Ç–µ—Å—Ç–∞–º–∏ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥).
  &#x20;üëâ –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (–ë–î, —Å–µ—Ä–≤–µ—Ä).
* `@AfterAll` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤.
  &#x20;üëâ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.
* `@BeforeEach` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º**.
  &#x20;üëâ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–±—ä–µ–∫—Ç–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è.
* `@AfterEach` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞**.
  &#x20;üëâ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–±—Ä–æ—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π).





***

## –ü—Ä–∏–º–µ—Ä

```java
import org.junit.jupiter.api.*;

class CalculatorTest {

    static Calculator calc;

    @BeforeAll
    static void setupAll() {
        System.out.println(">>> –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤");
        calc = new Calculator();
    }

    @BeforeEach
    void setup() {
        System.out.println(" -> –ù–æ–≤—ã–π —Ç–µ—Å—Ç");
    }

    @Test
    void testAddition() {
        assertEquals(5, calc.add(2, 3));
    }

    @Test
    void testSubtraction() {
        assertEquals(1, calc.subtract(3, 2));
    }

    @AfterEach
    void tearDown() {
        System.out.println(" <- –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω");
    }

    @AfterAll
    static void tearDownAll() {
        System.out.println("<<< –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã");
    }
}
```

üëâ –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—É–¥–µ—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞.





***

## Nested Tests (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)

JUnit 5 –ø–æ–∑–≤–æ–ª—è–µ—Ç **–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞**. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è `@Nested`.

* –°—Ç—Ä—É–∫—Ç—É—Ä–∞ "–ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º".
* –õ–µ–≥—á–µ —á–∏—Ç–∞—Ç—å —Ç–µ—Å—Ç—ã: –≤–∏–¥–Ω–æ, –∫–∞–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –¥–µ–ø–æ–∑–∏—Ç—É, –∫–∞–∫–∏–µ ‚Äî –∫ —Å–Ω—è—Ç–∏—é.
* –ú–æ–∂–Ω–æ —É –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏–º–µ—Ç—å —Å–≤–æ–π `@BeforeEach`.



```java
import org.junit.jupiter.api.*;

class BankAccountTest {

    BankAccount account;

    @BeforeEach
    void init() {
        account = new BankAccount(100);
    }

    @Test
    void shouldHaveInitialBalance() {
        assertEquals(100, account.getBalance());
    }

    @Nested
    class WhenDepositing {

        @Test
        void shouldIncreaseBalance() {
            account.deposit(50);
            assertEquals(150, account.getBalance());
        }

        @Test
        void shouldThrowException_whenDepositNegative() {
            assertThrows(IllegalArgumentException.class, () -> account.deposit(-10));
        }
    }

    @Nested
    class WhenWithdrawing {

        @Test
        void shouldDecreaseBalance() {
            account.withdraw(30);
            assertEquals(70, account.getBalance());
        }

        @Test
        void shouldThrowException_whenInsufficientFunds() {
            assertThrows(IllegalStateException.class, () -> account.withdraw(200));
        }
    }
}
```





***

## Lifecycle per class vs per method

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é JUnit —Å–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞**.

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è *per-method lifecycle*.

–ú–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ *per-class* (–æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤) —Å –ø–æ–º–æ—â—å—é –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏:

```java
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
class MyTest {
    // —Ç–µ–ø–µ—Ä—å @BeforeAll –∏ @AfterAll –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ù–ï —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏
}
```

–≠—Ç–æ —É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç —Ç—è–∂–µ–ª–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å, –Ω–æ –µ—Å—Ç—å —Ä–∏—Å–∫, —á—Ç–æ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ (—á—Ç–æ –ø–ª–æ—Ö–æ).





***

## Disabled —Ç–µ—Å—Ç—ã

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç:

```java
@Test
@Disabled("–ë—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏")
void shouldFailNow() {
    fail("Not implemented");
}
```





***

## Display Names (—á–∏—Ç–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤)

JUnit –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–∞–≤–∞—Ç—å **—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –∏–º–µ–Ω–∞ —Ç–µ—Å—Ç–∞–º**:

```java
@DisplayName("–¢–µ—Å—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞")
class CalculatorTest {

    @Test
    @DisplayName("–°–ª–æ–∂–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª")
    void addition() {
        assertEquals(5, new Calculator().add(2, 3));
    }
}
```

–í –æ—Ç—á—ë—Ç–∞—Ö –∏ IDE –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –Ω–µ `addition()`, –∞ `"–°–ª–æ–∂–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª"`.



