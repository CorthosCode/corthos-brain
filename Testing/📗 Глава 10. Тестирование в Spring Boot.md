
Spring Boot —É–∂–µ –∏–∑ –∫–æ—Ä–æ–±–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

* JUnit 5
* Mockito
* Spring Test Framework
* –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è MockMVC, WebTestClient, Data JPA —Ç–µ—Å—Ç–æ–≤ –∏ –¥—Ä.

–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```groovy
testImplementation 'org.springframework.boot:spring-boot-starter-test'
```

—Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –≤–µ—Å—å –Ω—É–∂–Ω—ã–π –Ω–∞–±–æ—Ä.


***

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤ –≤ Spring Boot

| –¢–∏–ø —Ç–µ—Å—Ç–∞               | –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è                                        | –ß—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è          | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                              |
| ----------------------- | ------------------------------------------------ | ------------------------ | ----------------------------------------------- |
| **Unit-—Ç–µ—Å—Ç**           | ‚Äî                                                | –Ω–∏—á–µ–≥–æ                   | –ø—Ä–æ—Å—Ç—ã–µ –∫–ª–∞—Å—Å—ã –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                    |
| **Slice-—Ç–µ—Å—Ç—ã**         | `@WebMvcTest`, `@DataJpaTest`, `@JsonTest` –∏ –¥—Ä. | —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞   | –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ—è (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ —Ç.–ø.) |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç** | `@SpringBootTest`                                | –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤—Å–µ—Ö —Å–ª–æ—ë–≤              |


***

## @SpringBootTest

–≠—Ç–æ ¬´—Ç—è–∂—ë–ª—ã–π¬ª —Ç–µ—Å—Ç ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ—Ç **–≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç Spring Boot** (–≤—Å–µ –±–∏–Ω—ã, –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –ë–î, —Å–µ—Ä–≤–µ—Ä –∏ —Ç.–¥.).

```java
@SpringBootTest
class ApplicationTests {

    @Test
    void contextLoads() {
        // –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
    }
}
```

–ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —É–∫–∞–∑–∞—Ç—å:

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
```

‚Äî —á—Ç–æ–±—ã –ø–æ–¥–Ω—è–ª—Å—è HTTP-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—Ç—É, –µ—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã.


***

## –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ —Å–æ –≤—Å–µ–π –ª–æ–≥–∏–∫–æ–π

```java
@SpringBootTest
class UserServiceIntegrationTest {

    @Autowired
    private UserService userService;

    @Autowired
    private UserRepository repo;

    @Test
    void shouldSaveUser() {
        User user = new User("Alice");
        userService.saveUser(user);

        assertTrue(repo.findByName("Alice").isPresent());
    }
}
```

üí° –í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, DI —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î).


***

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@MockBean`

–ò–Ω–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –î–æ–ø—É—Å—Ç–∏–º, —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –Ω–æ –µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ª—É—á—à–µ –∑–∞–º–æ–∫–∞—Ç—å.

Spring –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é ‚Äî **`@MockBean`**, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –º–æ–∫ **–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Spring**, –∞ –Ω–µ –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ Mockito.mock().

```java
@SpringBootTest
class UserServiceSpringTest {

    @MockBean
    private UserRepository repo; // –º–æ–∫ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ Spring

    @Autowired
    private UserService service; // –≤ –Ω–µ–≥–æ –±—É–¥–µ—Ç –≤–Ω–µ–¥—Ä—ë–Ω —ç—Ç–æ—Ç –º–æ–∫

    @Test
    void shouldReturnUserFromRepo() {
        Mockito.when(repo.findById("1"))
               .thenReturn(Optional.of(new User("1", "Alice")));

        User result = service.findUser("1");

        assertEquals("Alice", result.getName());
    }
}
```

‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

* –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–π.
* –ù–æ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ (–≤–∫–ª—é—á–∞—è —Å–∞–º `UserService`) —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.


***

## @WebMvcTest

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã**, –±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ –∏ –ë–î.

```java
@WebMvcTest(UserController.class)
class UserControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private UserService service;

    @Test
    void shouldReturnUser() throws Exception {
        Mockito.when(service.findUser("1"))
               .thenReturn(new User("1", "Alice"));

        mockMvc.perform(get("/users/1"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.name").value("Alice"));
    }
}
```

–ó–¥–µ—Å—å:

* `MockMvc` ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.
* `@MockBean` ‚Äî –ø–æ–¥–º–µ–Ω—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
* `@WebMvcTest` –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–ª–æ–π Web (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Ç.–¥.).


***

## @DataJpaTest

–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤** (DAO).

Spring –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–ª–æ–π –¥–∞–Ω–Ω—ã—Ö** (EntityManager, DataSource, Hibernate).

```java
@DataJpaTest
class UserRepositoryTest {

    @Autowired
    private UserRepository repo;

    @Test
    void shouldSaveAndFindUser() {
        User user = new User("Alice");
        repo.save(user);

        Optional<User> result = repo.findByName("Alice");
        assertTrue(result.isPresent());
    }
}
```

üí° –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è in-memory –ë–î** (–Ω–∞–ø—Ä–∏–º–µ—Ä, H2), –∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞.


***

## `@TestConfiguration` –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –±–∏–Ω—ã

–ï—Å–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Å–æ–±—ã–π –±–∏–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–µ–π–∫–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å), –º–æ–∂–Ω–æ –æ–±—ä—è–≤–∏—Ç—å –µ–≥–æ —Å –ø–æ–º–æ—â—å—é `@TestConfiguration`:

```java
@TestConfiguration
static class TestConfig {
    @Bean
    UserRepository fakeRepo() {
        return new FakeUserRepository();
    }
}
```

Spring –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —ç—Ç–æ—Ç –±–∏–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∞.


***

## –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∏ application.yml

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤:

`src/test/resources/application-test.yml`

```yaml
spring:
  datasource:
    url: jdbc:h2:mem:testdb
  jpa:
    hibernate:
      ddl-auto: create-drop
```

–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã —Å:

```java
@SpringBootTest
@ActiveProfiles("test")
class MyTest { ... }
```

