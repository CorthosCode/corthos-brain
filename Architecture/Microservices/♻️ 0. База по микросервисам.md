
**Микросервис** – это небольшая, слабо связанная распределенная служба.

Микросервисы позволяют взять приложение с обширным набором функций и разложить его на простые в управлении компоненты с четко определенными обязанностями.

Микросервисы помогают преодолевать традиционные проблемы сложности большой базы кода, разбивая ее на небольшие четко определенные части

Ключевые понятия, о которых следует помнить, рассуждая о микросервисах, – это **декомпозиция** и **развязка** (unbunding). Функции приложений должны быть полностью независимы друг от друга.


---

## Характеристики микросервисной архитектуры:

- Логика приложения разбита на мелкие компоненты с четко определенными согласованными границами ответственности;
- Каждый компонент отвечает за узкий круг задач и развертывается независимо от других; один микросервис отвечает за одну часть предметной области;
- Для обмена данными между собой микросервисы используют облегченные протоколы, такие как HTTP и JSON (JavaScript Object Notation – форма записи объектов JavaScript);
- Приложения на основе микросервисов всегда обмениваются данными с использованием технологически нейтрального формата (чаще всего используется JSON), поэтому техническая реализация службы не имеет значения; это означает, что приложение, состоящее из микросервисов, может быть написано на нескольких языках и с использованием нескольких технологий;
- Микросервисы – благодаря небольшому размеру, независимому и распределенному характеру – позволяют организациям иметь небольшие группы разработчиков с четко определенными сферами ответственности. Эти группы могут работать над достижения единой цели, например над созданием приложения, но каждая несет ответственность только за те службы, над которыми они работают.


---

## Характеристики распределенной среды

«Разбив» приложения на мелкие службы и переместив их из единого монолитного артефакта в распределенную среду, можно строить системы: 
- Гибкие – отдельные службы можно конструировать и реорганизовывать независимо друг от друга и быстро предоставлять новые возможности. Чем меньше единица служба, тем проще ее изменить и тем меньше времени уходит на ее тестирование и развертывание;
- Устойчивые – приложение, разделенное на отдельные службы, больше не представляет собой единый «комок грязи», в котором выход из строя одной части приводит к сбою всего приложения. Сбои можно локализовать в небольшой части приложения и устранить до того, как приложение остановится. В случае неисправимой ошибки приложение может продолжать работать, оказывая более узкий круг услуг;
- Масштабируемые – приложение, разделенное на отдельные службы, легко распределить по горизонтали между несколькими серверами и тем самым масштабировать функции/службы. В монолитном приложении, где вся логика взаимосвязана, приложение должно масштабироваться целиком, даже если узким местом является лишь небольшая его часть. Масштабирование небольших служб проще и намного рентабельнее.


> Небольшие, простые и разделенные службы = масштабируемые, устойчивые и гибкие приложения.


---

## Закон Конвея (Melvin R. Conway)

В законе Конвея (впервые был описан в апреле 1968 года Мелвином Р. Конвеем (Melvin R. Conway) в статье «How Do Committees Invent») говорится, что «организации, проектирующие системы... ограничены дизайном, который копирует структуру коммуникации в этой организации».

> По сути, это означает, что характер коммуникации внутри команды и между командами напрямую отражается в коде, который они создают.

Если применить закон Конвея в обратном порядке (также известный как обратный маневр Конвея) и спроектировать структуру компании, опираясь на микросервисную архитектуру, то коммуникация, стабильность и организационная структура приложений улучшатся, если создать слабосвязанные и автономные группы для реализации микросервисов.


---

## Нечто как услуга (anything as a service)

Модели облачных вычислений позволяют пользователю выбирать уровень контроля над информацией и услугами, которые они предоставляют.

Эти модели известны своими аббревиатурами обычно в формате XaaS, обозначающими нечто как услуга (anything as a service). Ниже перечислены наиболее распространенные модели облачных вычислений, а на рисунке показаны различия между этими моделями.

![Нечто как услуга](assets/Microservices/as_a_service.png)


**Инфраструктура как услуга (Infrastructure as a Service, IaaS)**

Поставщик предоставляет инфраструктуру, которая позволяет получать доступ к вычислительным ресурсам, таким как серверы, хранилища и сети.

В этой модели пользователь сам отвечает за все, что связано с обслуживанием инфраструктуры и масштабированием приложений.

Примерами платформ IaaS могут служить AWS (EC2), Azure Virtual Machines, Google Compute Engine и Kubernetes.


**Контейнер как услуга (Container as a Service, CaaS)**

Промежуточная модель между **IaaS** и **PaaS**. Относится к форме виртуализации на основе контейнеров.

В отличие от модели IaaS, где разработчик имеет полный контроль над виртуальной машиной, где развертывается служба, в модели CaaS вам предоставляется легковесный переносимый виртуальный контейнер (например, Docker).

Поставщик облачных услуг запускает виртуальный сервер, на котором выполняется контейнер, а также имеются инструменты для создания, развертывания, мониторинга и масштабирования контейнеров.

Примерами платформ CaaS могут служить Google Container Engine (GKE) и Amazon Elastic Container Service (ECS).


**Платформа как услуга (Platform as a Service, PaaS)**

Эта модель предоставляет платформу и окружение, которые позволяют пользователям сосредоточиться на разработке, выполнении и обслуживании приложения.

Приложения могут создаваться с помощью инструментов, предоставляемых поставщиком услуги (например, операционная система, системы управления базами данных, техническая поддержка, хранилище, хостинг, сеть и т. д.).

Пользователям не нужно вкладывать средства в физическую инфраструктуру или тратить время на управление ею, что позволяет им сосредоточиться исключительно на разработке приложений.

Примерами платформ PaaS могут служить Google App Engine, Cloud Foundry, Heroku и AWS Elastic Beanstalk.


**Функция как услуга (Function as a Service, FaaS)**

Также известна как бессерверная архитектура – несмотря на такое интересное название, эта архитектура не означает, что код выполняется без сервера.

Эта модель предлагает возможность выполнения функций в облаке, которым поставщик услуги предоставляет все необходимые серверы.

Бессерверная архитектура позволяет сосредоточиться исключительно на разработке служб, не беспокоясь о масштабировании, инициализации и администрировании серверов. То есть мы можем сосредоточиться только на наших функциях, не заботясь о какой-либо административной инфраструктуре.

Примерами платформ FaaS могут служить AWS (Lambda), Google Cloud Function и Azure Functions.


**Программное обеспечение как услуга (Software as a Service, SaaS)**

Эта модель, также известная как программное обеспечение по запросу, позволяет пользователям использовать конкретное приложение без необходимости развертывать или обслуживать его.

В большинстве случаев доступ к таким приложениям осуществляется через веб-браузер. Управление приложением, данными, операционной системой, виртуализацией, серверами, хранилищем и сетью осуществляет поставщик услуг. 

Пользователь просто приобретает услугу и использует программное обеспечение. 

Примерами платформ SaaS могут служить Salesforce, SAP и Google Business.


---

## Наиболее типичные характеристики облачных услуг CaaS:

- **Упрощенное управление инфраструктурой**. Поставщики облачных услуг CaaS дают вам возможность контролировать работу своих служб и запускать и останавливать службы с помощью простых вызовов API.
- **Значительная горизонтальная масштабируемость**. Поставщики облачных услуг CaaS позволяют быстро запустить один или несколько экземпляров службы. Эта означает, что вы можете быстро масштабировать службы и направлять трафик в обход неисправных серверов.
- **Высокая избыточность за счет географического распределения**. Провайдеры CaaS имеют несколько центров обработки данных. Развертывая свои микросервисы на платформе CaaS, вы можете получить более высокий уровень избыточности, чем может дать использование кластеров в одном центре обработки данных.


---

## Рекомендации при построении микросервисов

Идея создания отдельных микросервисов проста и понятна, но запуск и поддержка отказоустойчивого приложения на основе микросервисов (особенно в облаке) предполагают нечто большее, чем просто написание программного кода службы. На рисунке показаны некоторые рекомендации, которые следует учитывать при создании микросервиса.

![Рекомендации при построении микросервисов](assets/Microservices/recommendation.png)


> Микросервисы – это не только бизнес-логика. Вам нужно подумать об окружении, в котором будут выполняться службы, и как эти службы будут масштабироваться

**Оптимальный размер**. Выбирайте оптимальный размер для своих микросервисов, чтобы не возложить на них слишком широкие обязанности. Помните, что выбор правильного размера служб позволяет быстро вносить изменения и снижает общий риск сбоя всего приложения.

**Прозрачность местоположения**. Контролируйте физические детали вызова службы. В приложении на основе микросервисов несколько экземпляров службы могут быстро запускаться и завершаться.

**Устойчивость**. Защищайте пользователей ваших микросервисов и приложение в целом, организуя маршрутизацию в обход отказавших служб и используя решения «отказоустойчивости».

**Повторяемость**. Гарантируйте использование одной и той же версии кода и конфигурации при запуске каждого нового экземпляра вашей службы.

**Масштабируемость**. Организуйте взаимодействия так, чтобы свести к минимуму прямые зависимости между вашими службами и гарантировать возможность плавного масштабирования своих микросервисов.


---

## Шаблоны проектирования микросервисов

- [[♻️ 1. Базовый шаблон разработки микросервисов]]
- [[♻️ 2. Шаблоны маршрутизации]]
- [[♻️ 3. Устойчивость клиентов]]
- [[♻️ 4. Шаблоны безопасности]]
- [[♻️ 5. Шаблоны журналирования и трассировки]]
- [[♻️ 6. Шаблон сбора метрик приложения]]
- [[♻️ 7. Шаблоны сборки (развертывания) микросервисов]]

