
Разработчики программного обеспечения постоянно слышат о важности отделения конфигурации приложения от кода.

В большинстве случаев это означает отказ от использования жестко запрограммированных настроек в коде.

Несоблюдение этого принципа может усложнить дальнейшее развитие приложения, поскольку при каждом изменении конфигурации приходится повторно компилировать и развертывать приложение.

Полное отделение конфигурации от кода приложения позволяет разработчикам и сопровождающим специалистам вносить изменения в конфигурацию без необходимости повторной компиляции.

Но это также влечет дополнительные сложности, потому что у разработчиков появляется еще один артефакт, которым нужно управлять и развертывать вместе с приложением.

Многие разработчики используют файлы свойств (YAML, JSON или XML) для хранения информации о конфигурации.

Хранение настроек приложения в этих файлах – настолько простая задача, что большинство разработчиков не делает ничего, кроме как помещают конфигурационные файлы в систему управления версиями и развертывают эти файлы вместе с приложением.

Этот подход более или менее применим для небольшого количества приложений, но быстро становится непригодным при работе с облачными приложениями, которые могут состоять из сотен микросервисов, каждый из которых может иметь несколько запущенных экземпляров.

Внезапно простой и понятный процесс становится необычайно сложным, и команде разработчиков приходится бороться со всеми этими конфигурационными файлами.

Например, представьте, что у нас есть несколько сотен микросервисов и каждый содержит разные конфигурации для трех окружений.

Если не управлять этими файлами отдельно, то при каждом изменении нам придется отыскать нужный файл в репозитории, проследить за процессом интеграции (если он есть) и перезапустить приложение.

Чтобы избежать этого катастрофического сценария, при разработке облачных микросервисов следует использовать следующие рекомендации:

- **полностью отделяйте конфигурацию** приложения от развертываемого кода;
- **создавайте неизменяемые образы приложений**, которые никогда не меняются по мере продвижения между окружениями;
- **передавайте любую конфигурацию через переменные окружения** или централизованный репозиторий, к которому микросервисы могут обратиться при запуске.


---

## Об управлении конфигурациями (и сложностью)

Управление конфигурацией приложений имеет решающее значение для микросервисов, работающих в облаке, потому что экземпляры микросервисов должны запускаться быстро и с минимальным вмешательством со стороны человека.

Когда человеку приходится вручную настраивать службу или развертывать ее, то возникает вероятность дрейфа конфигурации, неожиданного сбоя и задержки в реагировании на проблемы масштабируемости в приложении.

Четыре принципы, которым необходимо следовать для управления конфигурацией:

- **Отделение.** Мы должны полностью отделить конфигурацию службы от процесса ее развертывания. Конфигурация не должна развертываться вместе с экземпляром службы. Вместо этого информация о конфигурации должна передаваться в переменных окружения или извлекаться из централизованного репозитория в момент запуска службы.
- **Абстрагирование.** Также необходимо абстрагировать доступ к конфигурации с использованием служебного интерфейса. Служба не должна содержать код, который напрямую читает конфигурацию из файлов или базы данных, вместо этого следует использовать REST-службу, возвращающую конфигурацию приложения в формате JSON.
- **Централизация.** Облачное приложение может содержать буквально сотни служб, поэтому очень важно свести к минимуму количество различных репозиториев, используемых для хранения конфигураций. Храните конфигурации своих приложений в как можно меньшем количестве репозиториев.
- **Надежность.** Информация о конфигурации приложения будет полностью отделена от развернутой службы и централизована, поэтому очень важно, чтобы служба, управляющая конфигурациями, была высокодоступной и избыточной.

Важно помнить, что при отделении конфигурации от фактического кода создается внешняя зависимость, которой нужно будет управлять и хранить в системе управления версиями.

Невозможно переоценить то обстоятельство, что конфигурация приложения должна управляться надлежащим образом, потому что неправильно организованное управление конфигурацией является благодатной почвой для трудно обнаруживаемых ошибок и незапланированных отключений.


---

## Архитектура управления конфигурацией

































