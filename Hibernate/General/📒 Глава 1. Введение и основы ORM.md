# üìí –ì–ª–∞–≤–∞ 1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ –æ—Å–Ω–æ–≤—ã ORM

## –ß—Ç–æ —Ç–∞–∫–æ–µ ORM –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω

**ORM (Object-Relational Mapping)** ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –æ–±—ä–µ–∫—Ç—ã.

–í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –º—ã –æ–ø–∏—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã, –∞ ORM –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ SQL.

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ ORM**

* –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–∏—Å–∞—Ç—å SQL –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.
* –ù—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ResultSet ‚Üí –æ–±—ä–µ–∫—Ç—ã –≤—Ä—É—á–Ω—É—é.
* –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Å SQL-–∫–æ–¥–æ–º.

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ORM**

* Java-–∫–ª–∞—Å—Å `User` ‚Üî —Ç–∞–±–ª–∏—Ü–∞ `users`.
* –ü–æ–ª—è –∫–ª–∞—Å—Å–∞ ‚Üî –∫–æ–ª–æ–Ω–∫–∏.
* Hibernate —Å–∞–º –¥–µ–ª–∞–µ—Ç `INSERT`, `UPDATE`, `DELETE`, `SELECT`.

–ü—Ä–∏–º–µ—Ä:

```java
User u = new User("Alex");
session.save(u); // Hibernate —Å–∞–º —Å–¥–µ–ª–∞–µ—Ç SQL: INSERT INTO users (name) VALUES ('Alex')
```





***

## –ß—Ç–æ —Ç–∞–∫–æ–µ Hibernate

Hibernate ‚Äî —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π ORM-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –≤ Java-–º–∏—Ä–µ.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ Hibernate:**

1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–±—ä–µ–∫—Ç–∞–º–∏.
2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.
3. –ú–∞–ø–ø–∏–Ω–≥ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (OneToMany, ManyToMany –∏ —Ç.–¥.).
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ.
5. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.



Hibernate vs JPA vs Spring Data

* **JPA (Java Persistence API)** ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (`@Entity`, `@Id`, `@OneToMany`), –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (`EntityManager`), –Ω–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
* **Hibernate** ‚Äî –æ–¥–Ω–∞ –∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π JPA + —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–∫–µ—à, HQL, natve SQL).
* **Spring Data JPA** ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ JPA, –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç boilerplate-–∫–æ–¥–∞, –Ω–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º —á–∞—â–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç Hibernate.

üëâ –¢–æ –µ—Å—Ç—å, –∫–æ–≥–¥–∞ —Ç—ã –ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `CrudRepository`, –Ω–∞ –¥–µ–ª–µ —Ä–∞–±–æ—Ç–∞–ª —Å Hibernate, –Ω–æ —á–µ—Ä–µ–∑ Spring Data.





***

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Hibernate

–ì–ª–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **Configuration** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (`hibernate.cfg.xml` –∏–ª–∏ `application.properties`).
2. **SessionFactory** ‚Äî —Ç—è–∂—ë–ª—ã–π –æ–±—ä–µ–∫—Ç, —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—É–ª–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.
3. **Session** ‚Äî —Ä–∞–±–æ—á–∞—è –µ–¥–∏–Ω–∏—Ü–∞, —á–µ—Ä–µ–∑ –Ω–µ—ë –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏.
4. **Transaction** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î.
5. **Entity** ‚Äî POJO-–∫–ª–∞—Å—Å —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π `@Entity`, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î.

üëâ –í Spring Boot —ç—Ç–æ —Å–∫—Ä—ã—Ç–æ –≤–Ω—É—Ç—Ä–∏, –Ω–æ –≤ —á–∏—Å—Ç–æ–º Hibernate –≤—Å—ë —è–≤–Ω–æ.





***

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Å Hibernate

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Maven)

```xml
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-core</artifactId>
    <version>6.4.4.Final</version>
</dependency>
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
    <version>42.7.3</version>
</dependency>
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (hibernate.cfg.xml)

```xml
<!DOCTYPE hibernate-configuration PUBLIC
        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">

<hibernate-configuration>
    <session-factory>
        <property name="hibernate.connection.driver_class">org.postgresql.Driver</property>
        <property name="hibernate.connection.url">jdbc:postgresql://localhost:5432/testdb</property>
        <property name="hibernate.connection.username">postgres</property>
        <property name="hibernate.connection.password">1234</property>

        <property name="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</property>
        <property name="hibernate.hbm2ddl.auto">update</property>
        <property name="hibernate.show_sql">true</property>

        <mapping class="com.example.User"/>
    </session-factory>
</hibernate-configuration>
```

Entity

```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    public User() {}
    public User(String name) { this.name = name; }
}
```

Main

```java
public class Main {
    public static void main(String[] args) {
        SessionFactory factory = new Configuration().configure().buildSessionFactory();
        Session session = factory.openSession();

        Transaction tx = session.beginTransaction();
        User user = new User("Alex");
        session.save(user);
        tx.commit();

        session.close();
        factory.close();
    }
}
```





***

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Hibernate

* `hibernate.hbm2ddl.auto` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π –ë–î:
  * `create` ‚Äî –∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ ‚Üí —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã –∑–∞–Ω–æ–≤–æ.
  * `create-drop` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, —É–¥–∞–ª—è–µ—Ç –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.
  * `update` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ö–µ–º—É –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö (–æ–ø–∞—Å–Ω–æ –≤ –ø—Ä–æ–¥–µ).
  * `validate` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ö–µ–º—É, –Ω–µ –∏–∑–º–µ–Ω—è—è –µ—ë.
  * `none` ‚Äî Hibernate –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –ë–î.
* `hibernate.show_sql=true` ‚Äî –≤—ã–≤–æ–¥–∏—Ç SQL –≤ –∫–æ–Ω—Å–æ–ª—å.
* `hibernate.format_sql=true` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç SQL –∫—Ä–∞—Å–∏–≤–æ.
* `hibernate.dialect` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç SQL-–¥–∏–∞–ª–µ–∫—Ç (PostgreSQL, MySQL –∏ —Ç.–¥.).





***

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ Hibernate

‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

* –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ (CRUD –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω).
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–æ—Å—Å-–ë–î.
* –ë–æ–≥–∞—Ç—ã–π —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (HQL).
* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏.

‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

* –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π SQL –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º).
* –ö—Ä–∏–≤–∞—è –æ–±—É—á–µ–Ω–∏—è (–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—ä–µ–∫—Ç–æ–≤, lazy loading).
* –ú–µ–Ω—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å, —á–µ–º –ø—Ä–∏ —Ä—É—á–Ω–æ–º SQL.



