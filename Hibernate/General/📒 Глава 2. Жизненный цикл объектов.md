# üìí –ì–ª–∞–≤–∞ 2. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—ä–µ–∫—Ç–æ–≤

Hibernate —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ –Ω–∞–ø—Ä—è–º—É—é —Å –ë–î, –∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ –ø–∞–º—è—Ç–∏ (**Persistence Context**).

–ß—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ –ø–∞–º—è—Ç–∏ –∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î, Hibernate –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å:

* –æ–±—ä–µ–∫—Ç –Ω–æ–≤—ã–π –∏–ª–∏ —É–∂–µ –≤ –±–∞–∑–µ?
* –Ω—É–∂–Ω–æ –ª–∏ –µ–≥–æ –≤—Å—Ç–∞–≤–∏—Ç—å, –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å?
* –∫ –∫–∞–∫–æ–π —Å–µ—Å—Å–∏–∏ –æ–Ω –ø—Ä–∏–≤—è–∑–∞–Ω?

üëâ –û—Ç–≤–µ—Ç—ã –Ω–∞ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è **—Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (lifecycle state) –æ–±—ä–µ–∫—Ç–∞**.





***

## 1. Transient (–ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–µ, –≤—Ä–µ–º–µ–Ω–Ω–æ–µ)

* –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `new`.
* Hibernate –æ –Ω—ë–º –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç.
* –£ –Ω–µ–≥–æ –Ω–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ (`@Id`), –∏–ª–∏ –æ–Ω –Ω–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω —Å –∑–∞–ø–∏—Å—å—é –≤ –ë–î.

–ü—Ä–∏–º–µ—Ä:

```java
User user = new User("Alex"); // transient
```





***

## 2. Persistent (—Å–æ—Ö—Ä–∞–Ω—è–µ–º–æ–µ, —É–ø—Ä–∞–≤–ª—è–µ–º–æ–µ)

* –û–±—ä–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ Hibernate.
* –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –ë–î** –ø—Ä–∏ `flush`.
* –ü–æ–ª—É—á–∏—Ç—å –≤ persistent –º–æ–∂–Ω–æ:
  * —á–µ—Ä–µ–∑ `session.save(user)`
  * —á–µ—Ä–µ–∑ `session.get(User.class, id)`

–ü—Ä–∏–º–µ—Ä:

```java
Session session = factory.openSession();
Transaction tx = session.beginTransaction();

User user = new User("Alex"); // transient
session.save(user); // —Ç–µ–ø–µ—Ä—å persistent

user.setName("Alexander"); // Hibernate –∑–∞–ø–æ–º–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ (Dirty checking)
tx.commit(); // –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è UPDATE
```





***

## 3. Detached (–æ—Ç—Å–æ–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ)

* –û–±—ä–µ–∫—Ç **—Ä–∞–Ω—å—à–µ –±—ã–ª persistent**, –Ω–æ —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞.
* Hibernate –æ –Ω—ë–º –±–æ–ª—å—à–µ –Ω–µ –∑–Ω–∞–µ—Ç.
* –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω—ë–º **–Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ –ë–î**, –ø–æ–∫–∞ –º—ã –µ–≥–æ –Ω–µ ¬´–ø—Ä–∏–∫—Ä–µ–ø–∏–º¬ª –æ–±—Ä–∞—Ç–Ω–æ (`merge` –∏–ª–∏ `update`).

–ü—Ä–∏–º–µ—Ä:

```java
Session session1 = factory.openSession();
User user = session1.get(User.class, 1L); // persistent
session1.close(); // —Ç–µ–ø–µ—Ä—å detached

user.setName("Alex Updated"); // –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å—Ç—å, –Ω–æ Hibernate –∏—Ö –Ω–µ —É—á—Ç—ë—Ç
```





***

## 4. Removed (—É–¥–∞–ª—ë–Ω–Ω–æ–µ)

* –û–±—ä–µ–∫—Ç –ø–æ–º–µ—á–µ–Ω –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `session.remove(entity)`.
* –ü–æ—Å–ª–µ `commit()` –∑–∞–ø–∏—Å—å –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ –ë–î.





***

## –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

–ú–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ **–¥–∏–∞–≥—Ä–∞–º–º—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤**:

* `new` ‚Üí Transient
* `session.save(obj)` ‚Üí Persistent
* `session.close()` ‚Üí Detached
* `session.remove(obj)` ‚Üí Removed





***

## –í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –∫–∞–∫ —É–∑–Ω–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞?

Hibernate —Å–∞–º –≤–Ω—É—Ç—Ä–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ **Persistence Context**.

–ù–∞–ø—Ä—è–º—É—é —É –æ–±—ä–µ–∫—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ—Ç.

–ù–û:



**–í Hibernate 5+ –µ—Å—Ç—å —É—Ç–∏–ª–∏—Ç–∞:**

```java
session.contains(entity) 
```

‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç **persistent** –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏.

‚Üí `false`, –µ—Å–ª–∏ –æ–Ω **transient** –∏–ª–∏ **detached**.



**–í JPA (Hibernate —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)**

```java
EntityManager.contains(entity)
```



**–ö–æ—Å–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

* –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ `new` –∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è ‚Üí **transient**.
* –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ `session.get()` ‚Üí **persistent**.
* –ï—Å–ª–∏ `session.close()` –∏–ª–∏ `clear()` ‚Üí –æ–±—ä–µ–∫—Ç **detached**.





***

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã Hibernate –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏



**`save()`****&#x20;/&#x20;****`persist()`**

* –î–µ–ª–∞—é—Ç –æ–±—ä–µ–∫—Ç **persistent**.
* `persist()` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç id, `save()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.
* `persist()` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.



**`get()`****&#x20;/&#x20;****`find()`****&#x20;/&#x20;****`load()`**

* –ó–∞–≥—Ä—É–∂–∞—é—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –ë–î ‚Üí **persistent**.
* –†–∞–∑–Ω–∏—Ü–∞:
  * `get()` ‚Äî —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ—Ç SQL.
  * `load()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç proxy –∏ —Ç—è–Ω–µ—Ç SQL –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ (lazy).



**`update()`**

* –î–µ–ª–∞–µ—Ç **detached**-–æ–±—ä–µ–∫—Ç —Å–Ω–æ–≤–∞ **persistent**.
* ‚ö†Ô∏è –ï—Å–ª–∏ –≤ —Å–µ—Å—Å–∏–∏ —É–∂–µ –µ—Å—Ç—å persistent-—ç–∫–∑–µ–º–ø–ª—è—Ä —Å —Ç–µ–º –∂–µ id ‚Üí –æ—à–∏–±–∫–∞.



**`merge()`**

* –ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ **detached**-–æ–±—ä–µ–∫—Ç–∞ –≤ **persistent**-—ç–∫–∑–µ–º–ø–ª—è—Ä.
* –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–∂–µ –µ—Å—Ç—å –≤ —Å–µ—Å—Å–∏–∏.
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ `update()`.



**`delete()`****&#x20;/&#x20;****`remove()`**

* –ü–æ–º–µ—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ **removed**).



**`refresh()`**

* –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –ë–î, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—è –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.



**`evict()`****&#x20;/&#x20;****`detach()`**

* –ò—Å–∫–ª—é—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è **detached**.



**`clear()`**

* –û—á–∏—â–∞–µ—Ç –≤–µ—Å—å persistence context ‚Üí –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è **detached**.





***

## Dirty checking

Hibernate –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—ä–µ–∫—Ç–∞—Ö persistent –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∏–∑–º–µ–Ω—ë–Ω, Hibernate –ø—Ä–∏ `flush` —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL `UPDATE`.

üëâ Dirty checking —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ **persistent**.

üëâ –î–ª—è detached-–æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–¥–æ –≤—Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å (`merge`).





***

## Flush –∏ commit

* **flush** = —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å –ë–î.
* **commit** = –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

‚ö†Ô∏è –í–∞–∂–Ω–æ: `flush` –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–µ—Ä–µ–¥ `commit` –∏–ª–∏ –¥–∞–∂–µ –ø—Ä–∏ `query`.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—ä–µ–∫—Ç–µ –º–æ–≥—É—Ç —É–π—Ç–∏ –≤ –ë–î —Ä–∞–Ω—å—à–µ, —á–µ–º —Ç—ã –≤—ã–∑–æ–≤–µ—à—å `commit`.

–ü—Ä–∏–º–µ—Ä:

```sql
user.setName("Alex Updated");
// –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º session.createQuery(...) Hibernate –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å UPDATE!
```





***

## –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏



**LazyInitializationException**

* –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±—ã–ª lazy, –∞ —Å–µ—Å—Å–∏—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞.
* –ü—Ä–∏–º–µ—Ä:

```java
User u = session.get(User.class, 1L);
session.close();
u.getOrders().size(); // –æ—à–∏–±–∫–∞
```



**Update vs Merge**

* `update()` –ø–∞–¥–∞–µ—Ç, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç —Å —Ç–µ–º –∂–µ id —É–∂–µ persistent.
* `merge()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å–æ–∑–¥–∞–≤–∞—è –∫–æ–ø–∏—é.



**Detached –ª–æ–≤—É—à–∫–∞**

* –ú–Ω–æ–≥–∏–µ –Ω–æ–≤–∏—á–∫–∏ –¥—É–º–∞—é—Ç: "–Ø –∏–∑–º–µ–Ω–∏–ª –æ–±—ä–µ–∫—Ç, –æ–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è –∏ –≤ –ë–î".
* –ù–æ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç detached ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∏–∫–∞–∫ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ –ë–î.





***

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

| –°–æ—Å—Ç–æ—è–Ω–∏–µ  | –ß—Ç–æ —ç—Ç–æ?                                 | –ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å                  | –ö–∞–∫ –≤—ã–π—Ç–∏                       |
| ---------- | ---------------------------------------- | ---------------------------- | ------------------------------- |
| Transient  | –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç, –Ω–µ –≤ –ë–î                    | `new User()`                 | `save()`, `persist()`           |
| Persistent | Hibernate —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–æ–º             | `save()`, `get()`, `merge()` | `close()`, `evict()`, `clear()` |
| Detached   | –†–∞–Ω—å—à–µ –±—ã–ª persistent, –Ω–æ —Å–≤—è–∑—å –ø–æ—Ç–µ—Ä—è–Ω–∞ | `close()`, `clear()`         | `update()`, `merge()`           |
| Removed    | –û–±—ä–µ–∫—Ç –ø–æ–º–µ—á–µ–Ω –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ               | `delete()`, `remove()`       | –ø–æ—Å–ª–µ `commit()` –∏—Å—á–µ–∑–∞–µ—Ç       |





***

## –õ–∞–π—Ñ—Ö–∞–∫ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

* **Transient**: `session.contains(obj) == false` –∏ —É –æ–±—ä–µ–∫—Ç–∞ `id == null`.
* **Persistent**: `session.contains(obj) == true`.
* **Detached**: `session.contains(obj) == false`, –Ω–æ —É –æ–±—ä–µ–∫—Ç–∞ –µ—Å—Ç—å `id`.
* **Removed**: –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `remove()` –æ–±—ä–µ–∫—Ç –≤–µ–¥—ë—Ç —Å–µ–±—è –∫–∞–∫ Detached, –Ω–æ –ø—Ä–∏ `commit` —É–¥–∞–ª—è–µ—Ç—Å—è.





***

## –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞

```java
import jakarta.persistence.*;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;

@Entity
@Table(name = "users")
class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    public User() {}
    public User(String name) { this.name = name; }

    public Long getId() { return id; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    @Override
    public String toString() {
        return "User{id=" + id + ", name='" + name + "'}";
    }
}

public class HibernateLifecycleDemo {
    public static void main(String[] args) {
        SessionFactory factory = new Configuration()
                .configure("hibernate.cfg.xml")
                .addAnnotatedClass(User.class)
                .buildSessionFactory();

        // ----------------------------
        // 1. Transient ‚Üí Persistent
        // ----------------------------
        Session session1 = factory.openSession();
        Transaction tx1 = session1.beginTransaction();

        User u1 = new User("Alex"); // Transient (new)
        System.out.println("Session contains u1? " + session1.contains(u1)); // false

        session1.save(u1); // —Ç–µ–ø–µ—Ä—å Persistent
        System.out.println("After save -> contains u1? " + session1.contains(u1)); // true

        u1.setName("Alexander"); // Dirty checking -> UPDATE –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

        tx1.commit(); // flush + commit
        session1.close(); // —Ç–µ–ø–µ—Ä—å u1 Detached
        System.out.println("After session close -> contains u1? false");

        // ----------------------------
        // 2. Detached ‚Üí Persistent (update vs merge)
        // ----------------------------
        Session session2 = factory.openSession();
        Transaction tx2 = session2.beginTransaction();

        // u1 —Å–µ–π—á–∞—Å Detached (–º—ã –µ–≥–æ –∏–∑–º–µ–Ω–∏–º)
        u1.setName("Alex Updated Detached");

        // update() - –¥–µ–ª–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å–Ω–æ–≤–∞ persistent
        session2.update(u1);
        System.out.println("After update -> contains u1? " + session2.contains(u1)); // true

        tx2.commit();
        session2.close(); // —Å–Ω–æ–≤–∞ Detached

        // ----------------------------
        // 3. Detached ‚Üí Persistent —á–µ—Ä–µ–∑ merge
        // ----------------------------
        Session session3 = factory.openSession();
        Transaction tx3 = session3.beginTransaction();

        u1.setName("Merged Alex");
        User merged = (User) session3.merge(u1); // u1 –æ—Å—Ç–∞—ë—Ç—Å—è Detached, merged -> Persistent
        System.out.println("u1 == merged ? " + (u1 == merged)); // false!
        System.out.println("After merge -> contains u1? " + session3.contains(u1)); // false
        System.out.println("After merge -> contains merged? " + session3.contains(merged)); // true

        tx3.commit();
        session3.close();

        // ----------------------------
        // 4. remove(), refresh(), evict(), clear()
        // ----------------------------
        Session session4 = factory.openSession();
        Transaction tx4 = session4.beginTransaction();

        User userFromDb = session4.get(User.class, merged.getId()); // Persistent
        System.out.println("Loaded user -> " + userFromDb);

        // refresh() -> –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
        userFromDb.setName("Temp Change");
        session4.refresh(userFromDb); // —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑ –ë–î
        System.out.println("After refresh -> " + userFromDb);

        // evict() -> –∏—Å–∫–ª—é—á–∞–µ–º –∏–∑ Persistence Context
        session4.evict(userFromDb); 
        System.out.println("After evict -> contains? " + session4.contains(userFromDb)); // false

        // clear() -> –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        session4.clear();

        // remove() -> —É–¥–∞–ª–µ–Ω–∏–µ
        User toDelete = session4.get(User.class, merged.getId());
        session4.remove(toDelete); // —Ç–µ–ø–µ—Ä—å Removed
        System.out.println("User marked for removal: " + toDelete);

        tx4.commit(); // —Ä–µ–∞–ª—å–Ω–æ DELETE
        session4.close();

        factory.close();
    }
}
```



