# üìí –ì–ª–∞–≤–∞ 3. –ú–∞–ø–ø–∏–Ω–≥ —Å—É—â–Ω–æ—Å—Ç–µ–π

**–ú–∞–ø–ø–∏–Ω–≥ (mapping)** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–≤—è–∑—ã–≤–∞–Ω–∏—è:

* **–ö–ª–∞—Å—Å–æ–≤ Java** ‚Üî **—Ç–∞–±–ª–∏—Ü –ë–î**
* **–ü–æ–ª—è –∫–ª–∞—Å—Å–∞** ‚Üî **–∫–æ–ª–æ–Ω–æ–∫ —Ç–∞–±–ª–∏—Ü—ã**
* **–°–≤—è–∑–µ–π –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏** ‚Üî **–æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ –ë–î**

üëâ Hibernate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ JPA** (–∏–∑ `jakarta.persistence.*`) –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –º–∞–ø–ø–∏–Ω–≥–∞.





***

## @Entity

–ö–ª–∞—Å—Å-—Å—É—â–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—ã–π Hibernate –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î.

```java
import jakarta.persistence.*;

@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
}
```





***

## @Table

–ü–æ–∑–≤–æ–ª—è–µ—Ç —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏–º—è —Ç–∞–±–ª–∏—Ü—ã:

```java
@Entity
@Table(name = "users")
public class User { ... }
```





***

## @Id

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (PK).





***

## @GeneratedValue

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PK:

* **`IDENTITY`** ‚Äî –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç (MySQL, PostgreSQL).

```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
```

```sql
id BIGINT SERIAL PRIMARY KEY
```

‚ö†Ô∏è –ú–∏–Ω—É—Å: Hibernate —Å—Ä–∞–∑—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç `INSERT`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ID.



* **`SEQUENCE`** ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Oracle, PostgreSQL).

```java
@Id
@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "user_seq")
@SequenceGenerator(name = "user_seq", sequenceName = "user_sequence", allocationSize = 1)
private Long id;
```

```sql
create sequence user_sequence start 1 increment 1;
```

‚ö° Hibernate –º–æ–∂–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ –±—Ä–∞—Ç—å –ø–∞—á–∫—É id (—á–µ—Ä–µ–∑ `allocationSize`), —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –≤—Å—Ç–∞–≤–∫–∏.



* **`AUTO`** ‚Äî Hibernate —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç.

Hibernate —Å–∞–º –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ **–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∏–∞–ª–µ–∫—Ç–∞** –ë–î.

–û–±—ã—á–Ω–æ:

* PostgreSQL ‚Üí `SEQUENCE`
* MySQL ‚Üí `IDENTITY`
* Oracle ‚Üí `SEQUENCE`
* H2 ‚Üí `SEQUENCE`

```sql
@Id
@GeneratedValue(strategy = GenerationType.AUTO)
private Long id;
```

‚ö†Ô∏è –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —è–≤–Ω–æ (`SEQUENCE` –∏–ª–∏ `IDENTITY`), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å **–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ –ë–î**.



* **`TABLE`** ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

```java
@Id
@GeneratedValue(strategy = GenerationType.TABLE, generator = "user_gen")
@TableGenerator(name = "user_gen", table = "id_generator", pkColumnName = "gen_name", valueColumnName = "gen_value", allocationSize = 1)
private Long id;

```

```sql
create table id_generator (gen_name varchar(50), gen_value bigint);
```

‚ö†Ô∏è –≠—Ç–æ —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±, –ø–æ—á—Ç–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.





***

## @Column

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–æ–Ω–∫–∏.

```java
@Column(name = "username", nullable = false, length = 100, unique = true)
private String name;
```





***

## @Transient

–ï—Å–ª–∏ –ø–æ–ª–µ **—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–ª–∞—Å—Å–µ, –Ω–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î**.

```java
@Transient
private int cachedHashCode;
```

–ü—Ä–∏–º–µ—Ä—ã:

* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
* –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–ª–∞–∂–æ–∫ ¬´–≤—ã–±—Ä–∞–Ω –ª–∏ –æ–±—ä–µ–∫—Ç –≤ UI¬ª).
* –î–∞–Ω–Ω—ã–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–∞—à–µ–π –ë–î.



üëâ –û—Ç–ª–∏—á–∏–µ –æ—Ç ¬´–ø—Ä–æ—Å—Ç–æ –±–µ–∑ `@Column`¬ª:

* –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –ø–æ–ª–µ –±–µ–∑ `@Column`, Hibernate –≤—Å—ë —Ä–∞–≤–Ω–æ **–ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –µ–≥–æ –∑–∞–º–∞–ø–ø–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.
* –ê `@Transient` **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç** –ø–æ–ª–µ –∏–∑ –º–∞–ø–ø–∏–Ω–≥–∞.





***

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞–ø–ø–∏–Ω–≥

Hibernate —É–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å Java-—Ç–∏–ø—ã –∏ SQL-—Ç–∏–ø—ã.

| Java              | SQL (PostgreSQL –ø—Ä–∏–º–µ—Ä) |
| ----------------- | ----------------------- |
| `String`          | `varchar`               |
| `int` / `Integer` | `integer`               |
| `long` / `Long`   | `bigint`                |
| `boolean`         | `boolean`               |
| `LocalDate`       | `date`                  |
| `LocalDateTime`   | `timestamp`             |
| `BigDecimal`      | `numeric`               |

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –º–∞–ø–ø–∏–Ω–≥–æ–º:

```java
@Column(precision = 10, scale = 2)
private BigDecimal salary;
```





***

## One-to-One (–æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)

–û–¥–∏–Ω –æ–±—ä–µ–∫—Ç —Å–≤—è–∑–∞–Ω —Ä–æ–≤–Ω–æ —Å –æ–¥–Ω–∏–º –¥—Ä—É–≥–∏–º.

```java
@Entity
public class User {
    @Id @GeneratedValue
    private Long id;

    @OneToOne
    @JoinColumn(name = "profile_id") // FK
    private Profile profile;
}
```

```java
@Entity
public class Profile {
    @Id @GeneratedValue
    private Long id;
    private String bio;
}
```





***

## One-to-Many –∏ Many-to-One (–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º)

* –û–¥–Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö.
* –í –ë–î FK —Ö—Ä–∞–Ω–∏—Ç—Å—è —É ¬´–º–Ω–æ–≥–∏—Ö¬ª (`employee.department_id`).
* –í Java –º–æ–∂–Ω–æ –æ—Ç—Ä–∞–∑–∏—Ç—å –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã: `Department.employees` –∏ `Employee.department`.

```java
@Entity
public class Department {
    @Id @GeneratedValue
    private Long id;

    @OneToMany(mappedBy = "department", cascade = CascadeType.ALL)
    private List<Employee> employees = new ArrayList<>();
}
```

```java
@Entity
public class Employee {
    @Id @GeneratedValue
    private Long id;

    @ManyToOne
    @JoinColumn(name = "department_id")
    private Department department;
}
```

üëâ –ó–¥–µ—Å—å `mappedBy` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å–≤—è–∑–∏ (Employee ‚Üí Department).





***

## Many-to-Many (–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)

–í –ë–î —ç—Ç–æ –≤—Å–µ–≥–¥–∞ **join-—Ç–∞–±–ª–∏—Ü–∞** (`student_course`).

```java
@Entity
public class Student {
    @Id @GeneratedValue
    private Long id;

    @ManyToMany
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses = new ArrayList<>();
}
```

```java
@Entity
public class Course {
    @Id @GeneratedValue
    private Long id;

    @ManyToMany(mappedBy = "courses")
    private List<Student> students = new ArrayList<>();
}
```

Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `student_course`.





***

## –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ –º–∞–ø–ø–∏–Ω–≥–µ

–ò–Ω–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å –∫–ª–∞—Å—Å—ã —Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º. Hibernate –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:



### Single Table (–æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞ –≤—Å—ë –¥–µ—Ä–µ–≤–æ)

* –í—Å–µ –ø–æ–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ.
* –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–æ–π `dtype`.

```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype", discriminatorType = DiscriminatorType.STRING)
public abstract class Payment {
    @Id @GeneratedValue
    private Long id;
    private BigDecimal amount;
}

@Entity
@DiscriminatorValue("CARD")
public class CardPayment extends Payment {
    private String cardNumber;
}

@Entity
@DiscriminatorValue("CASH")
public class CashPayment extends Payment {
    private String receiptNumber;
}
```

**`@DiscriminatorColumn`****&#x20;**&#x418;—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ **SINGLE\_TABLE** (–≤—Å—ë –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ).

üëâ `dtype` (discriminator column) = Hibernate –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫–æ–π –∫–ª–∞—Å—Å —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (`CARD` ‚Üí `CardPayment`).

SQL-—Ç–∞–±–ª–∏—Ü–∞ `payment`:

| id | amount | cardNumber | receiptNumber | dtype |
| -- | ------ | ---------- | ------------- | ----- |
| 1  | 100.00 | 1234-5678  | null          | CARD  |
| 2  | 50.00  | null       | R123          | CASH  |



–ï—Å–ª–∏ `Payment` –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π Hibernate –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã **—Å–∞–º–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞**.

```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype")
public class Payment { ... }

@Entity
@DiscriminatorValue("CARD")
public class CardPayment extends Payment { ... }

@Entity
@DiscriminatorValue("CASH")
public class CashPayment extends Payment { ... }
```

```java
Payment base = new Payment();
base.setAmount(new BigDecimal("100.00"));
session.persist(base);
```

| id | amount | cardNumber | receiptNumber | dtype                  |
| -- | ------ | ---------- | ------------- | ---------------------- |
| 1  | 100.00 | null       | null          | `Payment` (–∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç) |

üëâ –ï—Å–ª–∏ —Ç—ã –ù–ï —É–∫–∞–∂–µ—à—å `@DiscriminatorValue` –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞, Hibernate —Å–∞–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∏–º—è –∫–ª–∞—Å—Å–∞ (`Payment`).



### Joined (—Ç–∞–±–ª–∏—Ü–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å + join)

```java
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
public abstract class Payment { ... }
```



### Table Per Class (–∫–∞–∂–¥—ã–π –ø–æ–¥–∫–ª–∞—Å—Å –≤ —Å–≤–æ–µ–π —Ç–∞–±–ª–∏—Ü–µ).

üëâ –û–±—ã—á–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç **JOINED** –∏–ª–∏ **SINGLE\_TABLE**.





***

## –ö–∞—Å–∫–∞–¥—ã (CASCADE) –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π

–ö–∞—Å–∫–∞–¥—ã = —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –¥–æ—á–µ—Ä–Ω–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å —Ä–æ–¥–∏—Ç–µ–ª–µ–º.

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –¥–æ–ª–∂–Ω—ã –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (save, delete) –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ —Å–≤—è–∑–∞–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º.

```java
@OneToMany(mappedBy = "department", cascade = CascadeType.ALL)
private List<Employee> employees;
```

–¢–∏–ø—ã –∫–∞—Å–∫–∞–¥–æ–≤:

* `PERSIST` ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.
* `MERGE` ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.
* `REMOVE` ‚Üí —É–¥–∞–ª–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.
* `REFRESH` ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –∏–∑ –ë–î –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.
* `DETACH` ‚Üí –æ—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.
* `ALL` ‚Üí –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ.

–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:

```java
Department d = new Department();
Employee e = new Employee();
d.getEmployees().add(e);

session.persist(d); 
// –±–ª–∞–≥–æ–¥–∞—Ä—è CascadeType.PERSIST Hibernate –≤—Å—Ç–∞–≤–∏—Ç –∏ Department, –∏ Employee
```



–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –º–∞—Å—Å–∏–≤ –Ω—É–∂–Ω—ã—Ö –∫–∞—Å–∫–∞–¥–æ–≤:

```java
@OneToMany(mappedBy = "department", 
           cascade = {CascadeType.PERSIST, CascadeType.MERGE})
private List<Employee> employees;
```

–¢–æ–≥–¥–∞:

* –ø—Ä–∏ `persist(department)` ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∏ employee,
* –ø—Ä–∏ `merge(department)` ‚Üí –æ–±–Ω–æ–≤–∏—Ç—Å—è –∏ employee,
* –Ω–æ –ø—Ä–∏ `remove(department)` ‚Üí —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ù–ï —É–¥–∞–ª—è—Ç—Å—è.

üëâ –≠—Ç–æ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç, –µ—Å–ª–∏ `ALL` —Å–ª–∏—à–∫–æ–º ¬´–æ–ø–∞—Å–µ–Ω¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ —Ö–æ—á–µ—à—å —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏).





***

## FetchType

–ö–∞–∫ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

* `EAGER` ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –≤–º–µ—Å—Ç–µ.
* `LAZY` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏.

```java
@ManyToOne(fetch = FetchType.LAZY)
private Department department;
```





***

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∞–ø–ø–∏–Ω–≥–∞

* `@Embedded` –∏ `@Embeddable` ‚Üí –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å—É—â–Ω–æ—Å—Ç–∏ (Value Objects).
* `@ElementCollection` ‚Üí –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤.
* `@Enumerated` ‚Üí —Ö—Ä–∞–Ω–µ–Ω–∏–µ Enum.
* `@Lob` ‚Üí —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (CLOB/BLOB).

–ü—Ä–∏–º–µ—Ä —Å –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ–º:

```java
@Embeddable
public class Address {
    private String city;
    private String street;
}

@Entity
public class User {
    @Id @GeneratedValue
    private Long id;

    @Embedded
    private Address address;
}
```





***

## `mappedBy`

`mappedBy` = ¬´—ç—Ç–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –ù–ï –≤–ª–∞–¥–µ–ª–µ—Ü, –∞ –ø—Ä–æ—Å—Ç–æ –∑–µ—Ä–∫–∞–ª–æ¬ª.

–í–ª–∞–¥–µ–ª–µ—Ü = —Ç–∞ —Å—Ç–æ—Ä–æ–Ω–∞, –≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ –ª–µ–∂–∏—Ç **FK (foreign key)** –≤ —Ç–∞–±–ª–∏—Ü–µ.



### –ü—Ä–∏–º–µ—Ä 1: OneToMany

* –£ —Ç–µ–±—è –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã: `Department` –∏ `Employee`.
* –í —Ç–∞–±–ª–∏—Ü–µ `Employee` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `department_id` (FK).

–ö–æ–¥:

```java
@Entity
class Department {
    @Id Long id;
    
    @OneToMany(mappedBy = "department") // –ù–ï –≤–ª–∞–¥–µ–ª–µ—Ü, –ø—Ä–æ—Å—Ç–æ "—Å–ø–∏—Å–æ–∫"
    private List<Employee> employees;
}

@Entity
class Employee {
    @Id Long id;

    @ManyToOne
    @JoinColumn(name = "department_id") // –í–õ–ê–î–ï–õ–ï–¶ (FK —Ä–µ–∞–ª—å–Ω–æ —Ç—É—Ç)
    private Department department;
}
```

üëâ `mappedBy = "department"` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ–ª–µ –≤ `Employee`, –≥–¥–µ FK —Ö—Ä–∞–Ω–∏—Ç—Å—è.

–ï—Å–ª–∏ —É–±—Ä–∞—Ç—å `mappedBy`, Hibernate —Å–æ–∑–¥–∞—Å—Ç **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Å–≤—è–∑—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É** ‚Äî –∏ —ç—Ç–æ –±—É–¥–µ—Ç –ª–∏—à–Ω–µ–µ.



### –ü—Ä–∏–º–µ—Ä 2: ManyToMany

–ï—Å—Ç—å `Student` –∏ `Course`. –í ManyToMany **–≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞**.

```java
@Entity
class Student {
    @Id Long id;

    @ManyToMany
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses;
}

@Entity
class Course {
    @Id Long id;

    @ManyToMany(mappedBy = "courses") // –∑–µ—Ä–∫–∞–ª–æ, –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
    private List<Student> students;
}
```

üëâ `Student` —Å–æ–∑–¥–∞—ë—Ç join table, –∞ `Course` –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫.



### –ü—Ä–∏–º–µ—Ä 3: OneToOne

–£ `Person` –µ—Å—Ç—å `Passport`. –ö—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü? –¢–æ—Ç, —É –∫–æ–≥–æ –ª–µ–∂–∏—Ç FK.

```java
@Entity
class Person {
    @Id Long id;

    @OneToOne(mappedBy = "person") // –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
    private Passport passport;
}

@Entity
class Passport {
    @Id Long id;

    @OneToOne
    @JoinColumn(name = "person_id") // –≤–ª–∞–¥–µ–ª–µ—Ü (FK —Ç—É—Ç!)
    private Person person;
}
```

üëâ –ë–µ–∑ `mappedBy` Hibernate —Å–æ–∑–¥–∞—Å—Ç **–¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ FK** ‚Äî –∞ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ.

```sql
create table person (
    id bigserial not null,
    name varchar(255),
    primary key (id)
);

create table passport (
    id bigserial not null,
    number varchar(255),
    person_id bigint unique, -- –í–ê–ñ–ù–û! one-to-one ‚Üí FK + UNIQUE
    primary key (id),
    constraint fk_passport_person
        foreign key (person_id) references person (id)
);
```



### –ü—Ä–∏–º–µ—Ä 4: –ö–æ–¥ –±–µ–∑ `mappedBy`

```java
@Entity
class Person {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @OneToOne
    @JoinColumn(name = "passport_id") // FK ‚Üí –Ω–∞ –ø–∞—Å–ø–æ—Ä—Ç
    private Passport passport;
}

@Entity
class Passport {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String number;

    @OneToOne
    @JoinColumn(name = "person_id") // FK ‚Üí –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞
    private Person person;
}
```

üëâ Hibernate –≤–∏–¥–∏—Ç, —á—Ç–æ **–æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –≤–ª–∞–¥–µ—é—Ç —Å–≤—è–∑—å—é**, –∏ —Å–æ–∑–¥–∞—ë—Ç **–¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ —Å FK**.

SQL (PostgreSQL):

```sql
create table person (
    id bigserial not null,
    name varchar(255),
    passport_id bigint unique,
    primary key (id),
    constraint fk_person_passport
        foreign key (passport_id) references passport (id)
);

create table passport (
    id bigserial not null,
    number varchar(255),
    person_id bigint unique,
    primary key (id),
    constraint fk_passport_person
        foreign key (person_id) references person (id)
);
```

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å:

* –≤ `person` ‚Üí –∫–æ–ª–æ–Ω–∫–∞ `passport_id`
* –≤ `passport` ‚Üí –∫–æ–ª–æ–Ω–∫–∞ `person_id`

–¢–æ –µ—Å—Ç—å **–¥–≤–æ–π–Ω–∞—è —Å–≤—è–∑—å**, –∞ Hibernate –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–ü—Ä–∏–º–µ—Ä –≤—Å—Ç–∞–≤–∫–∏:

```sql
insert into person (name, passport_id) values ('Ivan Petrov', null); -- id=1
insert into passport (number, person_id) values ('AB123456', 1);     -- id=1
```

–í –∏—Ç–æ–≥–µ:

* –í `passport.person_id` = 1 (—Å—Å—ã–ª–∫–∞ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞).
* –í `person.passport_id` = NULL (–Ω–µ—Ç —Å—Å—ã–ª–∫–∏).

üëâ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è: —á–µ–ª–æ–≤–µ–∫ –≤—Ä–æ–¥–µ –∫–∞–∫ –±–µ–∑ –ø–∞—Å–ø–æ—Ä—Ç–∞, –∞ –ø–∞—Å–ø–æ—Ä—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —á–µ–ª–æ–≤–µ–∫—É.



### üìå –ó–∞–ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ:

* –í–ª–∞–¥–µ–ª–µ—Ü = –≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ –∫–æ–ª–æ–Ω–∫–∞ `FK` –≤ –ë–î.
* `mappedBy` = ¬´—è –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü, —è –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞—é –Ω–∞ –ø–æ–ª–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞¬ª.





***

## \[–®–ø–∞—Ä–≥–∞–ª–∫–∞] –ê–Ω–æ—Ç–∞—Ü–∏–∏ JPA/Hibernate

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è                      | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                 | –ü—Ä–∏–º–µ—Ä                                                    |
| ------------------------------ | ---------------- | ---------------------------------------------------------- | --------------------------------------------------------- |
| `@Entity`                      | –ö–ª–∞—Å—Å            | –î–µ–ª–∞–µ—Ç –∫–ª–∞—Å—Å —Å—É—â–Ω–æ—Å—Ç—å—é (–º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—É)               | `@Entity public class User { ... }`                       |
| `@Table`                       | –ö–ª–∞—Å—Å            | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã: –∏–º—è, —Å—Ö–µ–º–∞, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏            | `@Table(name = "users", schema = "public")`               |
| `@Id`                          | –ü–æ–ª–µ             | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                                             | `@Id private Long id;`                                    |
| `@GeneratedValue`              | –ü–æ–ª–µ             | –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è PK (`AUTO`, `IDENTITY`, `SEQUENCE`, `TABLE`) | `@GeneratedValue(strategy = GenerationType.IDENTITY)`     |
| `@SequenceGenerator`           | –ü–æ–ª–µ/–∫–ª–∞—Å—Å       | –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Oracle, PostgreSQL)          | `@SequenceGenerator(name="seq", sequenceName="user_seq")` |
| `@Column`                      | –ü–æ–ª–µ             | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–æ–Ω–∫–∏ (–∏–º—è, –¥–ª–∏–Ω–∞, nullable, unique)           | `@Column(name="username", length=100, nullable=false)`    |
| `@Transient`                   | –ü–æ–ª–µ             | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î                           | `@Transient private int cache;`                           |
| `@Basic`                       | –ü–æ–ª–µ             | –ë–∞–∑–æ–≤—ã–π –º–∞–ø–ø–∏–Ω–≥ (–æ–±—ã—á–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)                      | `@Basic(optional = false)`                                |
| `@Enumerated`                  | Enum             | –•—Ä–∞–Ω–µ–Ω–∏–µ enum (`ORDINAL` –∏–ª–∏ `STRING`)                     | `@Enumerated(EnumType.STRING)`                            |
| `@Lob`                         | –ü–æ–ª–µ             | –•—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (`CLOB`/`BLOB`)                  | `@Lob private String text;`                               |
| `@Temporal` (—É—Å—Ç–∞—Ä–µ–ª–∞ –≤ JPA 3) | –î–∞—Ç–∞/–≤—Ä–µ–º—è       | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è (`DATE`, `TIME`, `TIMESTAMP`)   | `@Temporal(TemporalType.DATE)`                            |





***

## \[–®–ø–∞—Ä–≥–∞–ª–∫–∞] –°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è     | –û—Ç–Ω–æ—à–µ–Ω–∏–µ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                     | –ü—Ä–∏–º–µ—Ä                                                                                                                                        |
| ------------- | --------- | ---------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| `@OneToOne`   | 1‚Äì1       | –û–¥–∏–Ω –æ–±—ä–µ–∫—Ç ‚Üî –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç                      | `@OneToOne @JoinColumn(name="profile_id") private Profile profile;`                                                                           |
| `@OneToMany`  | 1‚ÄìN       | –û–¥–∏–Ω ‚Üî –º–Ω–æ–≥–æ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫ `@ManyToOne`) | `@OneToMany(mappedBy="department") List<Employee> employees;`                                                                                 |
| `@ManyToOne`  | N‚Äì1       | –ú–Ω–æ–≥–∏–µ ‚Üî –æ–¥–∏–Ω                                  | `@ManyToOne @JoinColumn(name="dept_id") private Department department;`                                                                       |
| `@ManyToMany` | N‚ÄìN       | –ú–Ω–æ–≥–∏–µ ‚Üî –º–Ω–æ–≥–∏–µ (—á–µ—Ä–µ–∑ join table)             | `@ManyToMany @JoinTable(name="student_course", joinColumns=@JoinColumn(name="student_id"), inverseJoinColumns=@JoinColumn(name="course_id"))` |





***

## \[–®–ø–∞—Ä–≥–∞–ª–∫–∞] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è —Å–≤—è–∑–µ–π

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è     | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                        | –ü—Ä–∏–º–µ—Ä                                        |
| ------------- | ----------------------------------------------------------------- | --------------------------------------------- |
| `@JoinColumn` | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç FK –∫–æ–ª–æ–Ω–∫—É                                             | `@JoinColumn(name="dept_id", nullable=false)` |
| `@JoinTable`  | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –≤ `ManyToMany`                  | —Å–º. –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ                               |
| `mappedBy`    | –£–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å–≤—è–∑–∏ (—á—Ç–æ–±—ã Hibernate –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª –ª–∏—à–Ω–∏–π FK) | `@OneToMany(mappedBy="department")`           |
| `cascade`     | –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`PERSIST`, `MERGE`, `REMOVE`, `ALL`)          | `@OneToMany(cascade=CascadeType.ALL)`         |
| `fetch`       | –õ–µ–Ω–∏–≤–∞—è (`LAZY`) –∏–ª–∏ –∂–∞–¥–Ω–∞—è (`EAGER`) –∑–∞–≥—Ä—É–∑–∫–∞                    | `@ManyToOne(fetch=FetchType.LAZY)`            |





***

## \[–®–ø–∞—Ä–≥–∞–ª–∫–∞] –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è              | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                                      | –ü—Ä–∏–º–µ—Ä                                          |
| ---------------------- | ------------------------------------------------------------------------------- | ----------------------------------------------- |
| `@Inheritance`         | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (`SINGLE_TABLE`, `JOINED`, `TABLE_PER_CLASS`) | `@Inheritance(strategy=InheritanceType.JOINED)` |
| `@DiscriminatorColumn` | –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤ (–≤ `SINGLE_TABLE`)                            | `@DiscriminatorColumn(name="dtype")`            |
| `@DiscriminatorValue`  | –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–¥–∫–ª–∞—Å—Å–∞                                              | `@DiscriminatorValue("CARD")`                   |





***

## \[–®–ø–∞—Ä–≥–∞–ª–∫–∞] –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è            | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                   | –ü—Ä–∏–º–µ—Ä                                                                          |
| -------------------- | -------------------------------------------- | ------------------------------------------------------------------------------- |
| `@Embeddable`        | –ö–ª–∞—Å—Å –±–µ–∑ PK, –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –≤ –¥—Ä—É–≥–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ | `@Embeddable public class Address { ... }`                                      |
| `@Embedded`          | –í—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç                            | `@Embedded private Address address;`                                            |
| `@ElementCollection` | –ö–æ–ª–ª–µ–∫—Ü–∏—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤ –∏–ª–∏ `@Embeddable`    | `@ElementCollection List<String> phones;`                                       |
| `@CollectionTable`   | –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è `@ElementCollection`             | `@CollectionTable(name="user_phones", joinColumns=@JoinColumn(name="user_id"))` |





***

## \[–®–ø–∞—Ä–≥–∞–ª–∫–∞] Hibernate-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ)

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è            | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                      | –ü—Ä–∏–º–µ—Ä                                                                    |
| -------------------- | ----------------------------------------------- | ------------------------------------------------------------------------- |
| `@NaturalId`         | –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π (–±–∏–∑–Ω–µ—Å) –∫–ª—é—á                      | `@NaturalId private String email;`                                        |
| `@CreationTimestamp` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–≤–∏—Ç –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è              | `@CreationTimestamp private LocalDateTime created;`                       |
| `@UpdateTimestamp`   | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞—Ç—É –ø—Ä–∏ update         | `@UpdateTimestamp private LocalDateTime updated;`                         |
| `@Formula`           | –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞, –≤—ã—á–∏—Å–ª—è–µ–º–∞—è SQL-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º | `@Formula("concat(first_name, ' ', last_name)") private String fullName;` |
| `@Type`              | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç Hibernate-—Ç–∏–ø           | `@Type(JsonType.class) private JsonNode data;`                            |





***

## –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞



```java
@Entity
@Table(
        name = "users",
        schema = "public",
        uniqueConstraints = @UniqueConstraint(columnNames = {"email"}),
        indexes = @Index(name = "idx_users_name", columnList = "name")
)
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    private String email;

    @Transient
    private boolean loggedIn;

    // getters and setters
}
```

```sql
create table public.users (
    id bigserial not null,
    name varchar(255),
    email varchar(255),
    primary key (id),
    unique (email) -- –∏–∑ uniqueConstraints
);

create index idx_users_name on public.users (name);
```





```java
@Entity
public class Department {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @OneToMany(mappedBy = "department", cascade = {CascadeType.PERSIST, CascadeType.MERGE})
    private List<Employee> employees = new ArrayList<>();

    // getters and setters
}
```

```java
@Entity
public class Employee {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO) // Hibernate —Å–∞–º –≤—ã–±–µ—Ä–µ—Ç
    private Long id;

    private String fullName;

    @ManyToOne(cascade = {CascadeType.PERSIST, CascadeType.MERGE})
    @JoinColumn(name = "department_id") // –≤–ª–∞–¥–µ–ª–µ—Ü
    private Department department;

    // getters and setters
}
```

```sql
create table department (
    id bigserial not null,
    name varchar(255),
    primary key (id)
);

create table employee (
    id int8 not null, -- AUTO ‚Üí sequence –∏–ª–∏ identity (Postgres 15+)
    fullName varchar(255),
    department_id int8,
    primary key (id),
    constraint fk_employee_department foreign key (department_id)
        references department(id)
);
```





```java
@Entity
public class Student {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "student_seq")
    @SequenceGenerator(name = "student_seq", sequenceName = "student_seq", allocationSize = 1)
    private Long id;

    private String name;

    @ManyToMany
    @JoinTable(
            name = "student_course",
            joinColumns = @JoinColumn(name = "student_id"),
            inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses = new ArrayList<>();

    // getters and setters
}
```

```java
@Entity
public class Course {

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE, generator = "course_gen")
    @TableGenerator(name = "course_gen", table = "id_generator", pkColumnName = "gen_name",
            valueColumnName = "gen_value", allocationSize = 1)
    private Long id;

    private String title;

    @ManyToMany(mappedBy = "courses") // –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
    private List<Student> students = new ArrayList<>();

    // getters and setters
}
```

```sql
-- student
create sequence student_seq start 1 increment 1;

create table student (
    id int8 not null,
    name varchar(255),
    primary key (id)
);

-- course
create table id_generator (   -- –¥–ª—è TABLE generator
    gen_name varchar(255) not null,
    gen_value int8,
    primary key (gen_name)
);

insert into id_generator (gen_name, gen_value) values ('course_gen', 0);

create table course (
    id int8 not null,
    title varchar(255),
    primary key (id)
);

-- join table
create table student_course (
    student_id int8 not null,
    course_id int8 not null,
    primary key (student_id, course_id),
    constraint fk_student_course_student foreign key (student_id)
        references student(id),
    constraint fk_student_course_course foreign key (course_id)
        references course(id)
);
```





```java
@Entity
public class Person {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String fullName;

    @OneToOne(mappedBy = "person") // –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
    private Passport passport;

    // getters and setters
}
```

```java
@Entity
public class Passport {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String number;

    @OneToOne
    @JoinColumn(name = "person_id", unique = true) // –≤–ª–∞–¥–µ–ª–µ—Ü
    private Person person;

    // getters and setters
}
```

```sql
create table person (
    id bigserial not null,
    fullName varchar(255),
    primary key (id)
);

create table passport (
    id bigserial not null,
    number varchar(255),
    person_id int8 unique, -- —É–Ω–∏–∫–∞–ª—å–Ω—ã–π FK –¥–ª—è OneToOne
    primary key (id),
    constraint fk_passport_person foreign key (person_id)
        references person(id)
);
```





```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype", discriminatorType = DiscriminatorType.STRING)
public class Payment {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private BigDecimal amount;

    // getters and setters
}
```

```java
@Entity
@DiscriminatorValue("CASH")
public class CashPayment extends Payment {
    private String receiptNumber;

    // getters and setters
}
```

```java
@Entity
@DiscriminatorValue("CARD")
public class CardPayment extends Payment {
    private String cardNumber;

    // getters and setters
}
```

```sql
create table payment (
    id bigserial not null,
    amount numeric(19,2),
    dtype varchar(31) not null, -- DiscriminatorColumn
    cardNumber varchar(255),    -- –ø–æ–ª–µ –¥–æ—á–µ—Ä–Ω–µ–≥–æ CardPayment
    receiptNumber varchar(255), -- –ø–æ–ª–µ –¥–æ—á–µ—Ä–Ω–µ–≥–æ CashPayment
    primary key (id)
);
```





```java
public class MappingExample {
    public static void main(String[] args) {
        try (SessionFactory factory = new Configuration()
                .configure("hibernate.cfg.xml")
                .addAnnotatedClass(CardPayment.class)
                .addAnnotatedClass(CashPayment.class)
                .addAnnotatedClass(Course.class)
                .addAnnotatedClass(Department.class)
                .addAnnotatedClass(Employee.class)
                .addAnnotatedClass(Passport.class)
                .addAnnotatedClass(Payment.class)
                .addAnnotatedClass(Person.class)
                .addAnnotatedClass(Student.class)
                .addAnnotatedClass(User.class)
                .buildSessionFactory()) {


            Session session = factory.openSession();
            Transaction tx = session.beginTransaction();


            // ---- User ----
            User user = new User();
            user.setName("Ivan");
            user.setEmail("ivan@test.com");
            user.setLoggedIn(true); // –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ –ë–î
            session.persist(user);

            // ---- Department & Employee ----
            Department dep = new Department();
            dep.setName("IT");

            Employee e1 = new Employee();
            e1.setFullName("Petrov");
            e1.setDepartment(dep);

            dep.getEmployees().add(e1);

            session.persist(dep); // cascade ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∏ employee

            // ---- Student & Course ----
            Student s1 = new Student();
            s1.setName("Alex");

            Course c1 = new Course();
            c1.setTitle("Math");

            s1.getCourses().add(c1);
            c1.getStudents().add(s1);

            session.persist(s1); // cascade –Ω–µ—Ç, –Ω–∞–¥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã
            session.persist(c1);

            // ---- Person & Passport ----
            Person p1 = new Person();
            p1.setFullName("Sergey");

            Passport pass = new Passport();
            pass.setNumber("AB123456");
            pass.setPerson(p1);

            p1.setPassport(pass);

            session.persist(p1);
            session.persist(pass);

            // ---- Payments ----
            CardPayment card = new CardPayment();
            card.setAmount(new BigDecimal("100.00"));
            card.setCardNumber("1111-2222-3333-4444");
            session.persist(card);

            CashPayment cash = new CashPayment();
            cash.setAmount(new BigDecimal("50.00"));
            cash.setReceiptNumber("R12345");
            session.persist(cash);

            tx.commit();
            session.close();

        }
    }
}
```



