
`@EntityGraph` ‚Äî —ç—Ç–æ **JPA API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π**.

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å, **–∫–∞–∫–∏–µ –ø–æ–ª—è/—Å–≤—è–∑–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—Ä–∞–∑—É** –≤–º–µ—Å—Ç–µ —Å —Å—É—â–Ω–æ—Å—Ç—å—é.
* –†–∞–±–æ—Ç–∞–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ (–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ + hints), –±–µ–∑ –∂—ë—Å—Ç–∫–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∫ JPQL `JOIN FETCH`.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ JPA-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ (Hibernate, EclipseLink –∏ –¥—Ä.).

üëâ –¢–æ –µ—Å—Ç—å —ç—Ç–æ **–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞&#x20;****`JOIN FETCH`**, –Ω–æ –±–æ–ª–µ–µ –≥–∏–±–∫–∞—è –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–∞—è.


***

## –û—Å–Ω–æ–≤–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

* `@NamedEntityGraph` ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≥—Ä–∞—Ñ –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–±—ã—á–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—É—â–Ω–æ—Å—Ç–∏).
* `@NamedAttributeNode` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –ø–æ–ª—è –≤–∫–ª—é—á–∏—Ç—å.
* `@NamedSubgraph` ‚Äî –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ (–≥—Ä–∞—Ñ –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞—Ñ–∞).

–ü—Ä–∏–º–µ—Ä:

```java
@Entity
@NamedEntityGraph(
    name = "Department.withEmployees",
    attributeNodes = @NamedAttributeNode("employees")
)
public class Department {
    @Id
    private Long id;

    private String name;

    @OneToMany(mappedBy = "department")
    private List<Employee> employees;
}
```


***

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

**–†–∞–±–æ—Ç–∞ —Å EntityManager (JPA API/Hibernate API)**

```java
EntityGraph<?> graph = em.getEntityGraph("Department.withEmployees");

Map<String, Object> hints = new HashMap<>();
hints.put("javax.persistence.fetchgraph", graph); 

Department dep = em.find(Department.class, 1L, hints);
```

üëâ –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ `employees` –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤–º–µ—Å—Ç–µ —Å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–º.


[[üìí EntityManager]]


**–†–∞–±–æ—Ç–∞ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ Spring Data JPA**

Spring Data JPA –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ—ã –ø—Ä—è–º–æ –≤ –º–µ—Ç–æ–¥–∞—Ö:

```java
@EntityGraph(attributePaths = {"employees"})
@Query("select d from Department d")
List<Department> findAllWithEmployees();
```

–∏–ª–∏ –±–µ–∑ JPQL:

```java
@EntityGraph(attributePaths = {"employees"})
List<Department> findByName(String name);
```


***

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ (`hints`):

1. **`javax.persistence.fetchgraph`**
   * –°—á–∏—Ç–∞–µ—Ç—Å—è, —á—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ–ª—è, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –≥—Ä–∞—Ñ–µ, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã `EAGER`.
   * –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ `LAZY`.
   * –¢–æ –µ—Å—Ç—å –≥—Ä–∞—Ñ = ¬´–∂—ë—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ¬ª.
2. **`javax.persistence.loadgraph`**
   * –ü–æ–ª—è –∏–∑ –≥—Ä–∞—Ñ–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è `EAGER`.
   * –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö (`@OneToMany(fetch = ...)`).
   * –¢–æ –µ—Å—Ç—å –≥—Ä–∞—Ñ = ¬´—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª¬ª.


***

## –û—Ç–ª–∏—á–∏–µ –æ—Ç `JOIN FETCH`

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | JOIN FETCH (JPQL/HQL) | @EntityGraph                                      |
| ----------------- | --------------------- | ------------------------------------------------- |
| –ì–¥–µ –∑–∞–¥–∞—ë—Ç—Å—è      | –í JPQL-–∑–∞–ø—Ä–æ—Å–µ        | –í –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏–ª–∏ –∫–æ–¥–µ                              |
| SQL               | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JOIN       | –ú–æ–∂–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å JOIN –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ SELECT     |
| –ö–æ–Ω—Ç—Ä–æ–ª—å          | –ñ—ë—Å—Ç–∫–æ –≤—à–∏—Ç–æ –≤ –∑–∞–ø—Ä–æ—Å | –ì–∏–±–∫–æ, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å ¬´–ø–æ–≤–µ—Ä—Ö¬ª                  |
| –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –ù–µ—Ç                   | –î–∞ (–∏–º—è –≥—Ä–∞—Ñ–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö) |
| –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—Å—Ç—å     | Hibernate extension   | JPA —Å—Ç–∞–Ω–¥–∞—Ä—Ç                                      |

üëâ `JOIN FETCH` = ¬´—Ä–∞–∑–æ–≤–æ –ø–æ–¥—Ç—è–Ω—É–ª –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –∑–∞–ø—Ä–æ—Å–µ¬ª.

üëâ `EntityGraph` = ¬´–æ–ø–∏—Å–∞–ª —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –º–æ–≥—É –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö¬ª.


***

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤

–ú–æ–∂–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ `@NamedSubgraph`:

```java
@Entity
@NamedEntityGraph(
    name = "Department.withEmployeesAndProjects",
    attributeNodes = @NamedAttributeNode(value = "employees", subgraph = "empProjects"),
    subgraphs = @NamedSubgraph(
        name = "empProjects",
        attributeNodes = @NamedAttributeNode("projects")
    )
)
public class Department { ... }
```

üëâ –ó–¥–µ—Å—å –º—ã –∑–∞–≥—Ä—É–∑–∏–º –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç ‚Üí —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ ‚Üí –ø—Ä–æ–µ–∫—Ç—ã.


***

## –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

* **–ù–µ –≤—Å–µ–≥–¥–∞ JOIN**
  * –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `JOIN FETCH`, Hibernate –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SELECT-–æ–≤.
  * –≠—Ç–æ –Ω–µ –±–∞–≥, –∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è).
* **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å&#x20;****`EAGER/LAZY`**
  * –ï—Å–ª–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç –æ–¥–Ω–æ, –∞ –≥—Ä–∞—Ñ –¥—Ä—É–≥–æ–µ ‚Üí –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É `EntityGraph`.
* **–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å JPA API**
  * –¢–æ –µ—Å—Ç—å –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EntityManager` –∏–ª–∏ Spring Data.
  * –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å ¬´—á–∏—Å—Ç—ã–º Hibernate Session¬ª ‚Äî `EntityGraph` –æ–±—ë—Ä–Ω—É—Ç –ø–æ–≤–µ—Ä—Ö.


***

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

```java
// –≥—Ä–∞—Ñ –±–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
EntityGraph<Department> graph = em.createEntityGraph(Department.class);
graph.addAttributeNodes("employees");

Department dep = em.find(Department.class, 1L, 
    Collections.singletonMap("javax.persistence.loadgraph", graph)
);
```

üëâ –≠—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ ‚Äî –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –Ω–∞ –ª–µ—Ç—É, –±–µ–∑ `@NamedEntityGraph`.

